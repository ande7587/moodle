@block @block_quickmail @ui @javascript
Feature: Ensure that the groups filter control behaves as intended.




Background:
    Given the following "courses" exist:
        |fullname|shortname|category|
        |Course One| C1|0|
    And the following "users" exist:
        |username|firstname|lastname|
        |t1|t1|teacher|
        |t4|t4|editingteacher|
        |s1|s1|student|
        |s4|s4|student|
        |t2|t2|teacher|
        |s2|s2|student|
        |t3|t3|teacher|
        |s3|s3|student|
        |t5|t5|teacher|
        |s5|s5|student|
    And the following "course enrolments" exist:
        |user|course|role|
        |t1| C1|teacher|
        |t4| C1|editingteacher|
        |s1| C1|student|
        |s4| C1|student|
        |t2| C1|teacher|
        |s2| C1|student|
        |t3| C1|teacher|
        |s3| C1|student|
        |t5| C1|teacher|
        |s5| C1|student|
    And the following "groups" exist:
        |name|course|idnumber|
        |group1| C1|group1|
        |group2| C1|group2|
        |group3| C1|group3|
    And the following "group members" exist:
        |user|group|
        |t1|group1|
        |t4|group1|
        |t4|group2|
        |t4|group3|
        |s1|group1|
        |s4|group1|
        |s4|group2|
        |t2|group2|
        |s2|group2|
        |t3|group3|
        |s3|group3|
    Given I log in as "admin"
        And I navigate to "Define roles" node in "Site administration > Users > Permissions"
        And I click on "Edit" "link" in the "Non-editing teacher" "table_row"
        And I click on "Allow" "checkbox" in the "Access all groups" "table_row"
        And I press "Save changes"
        And I log out

    Given I log in as "t4"
        And I follow "Course One"
        And I turn editing mode on
        And I add the "Quickmail" block
        And I should see "Compose New Email" in the "Quickmail" "block"
        And I log out



# Configuration details:
# Students globally allowed to use Quickmail.
# Globally enforcing separate groups always.
# unrecognized setting for groupsCourse.
# Students allowed to use Quickmail at the course level.

Scenario: 25
    Given I log in as "admin"
        And I set the following administration settings values:
            |Allow students to use Quickmail|Yes|
            |FERPA Mode|Always Separate Groups|
        And I log out

        And I log in as "t4"
        And I follow "Course One"
        And I click on "Configuration" "link" in the "Quickmail" "block"
        And I set the following fields to these values:
            |Allow students to use Quickmail|Yes|
        And I press "Save changes"
        And I log out


        And I log in as "t1"
        And I follow "Course One"
        When I click on "Compose New Email" "link" in the "Quickmail" "block"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t4 editingteacher (group1)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t4 editingteacher (group1)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t4 editingteacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1)" in the "#mail_users" "css_element"
            And I should see "t4 editingteacher (group1)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t4 editingteacher (group1)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t4 editingteacher (group1)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t4 editingteacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1)" in the "#mail_users" "css_element"
            And I should see "t4 editingteacher (group1)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t4 editingteacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t4 editingteacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t4 editingteacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t4 editingteacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t4 editingteacher (group1)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t4 editingteacher (group1)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t4 editingteacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1)" in the "#mail_users" "css_element"
            And I should see "t4 editingteacher (group1)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I log out

        And I log in as "t4"
        And I follow "Course One"
        When I click on "Compose New Email" "link" in the "Quickmail" "block"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|group2|
            And I press "Add"
            And I should see "t2 teacher (group2)" in the "#mail_users" "css_element"
            And I should see "s2 student (group2)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|group2|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|group2|
            And I press "Add"
            And I should see "t2 teacher (group2)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|group2|
            And I press "Add"
            And I should see "s2 student (group2)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|group3|
            And I press "Add"
            And I should see "t3 teacher (group3)" in the "#mail_users" "css_element"
            And I should see "s3 student (group3)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|group3|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|group3|
            And I press "Add"
            And I should see "t3 teacher (group3)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|group3|
            And I press "Add"
            And I should see "s3 student (group3)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#mail_users" "css_element"
            And I should see "s2 student (group2)" in the "#mail_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#mail_users" "css_element"
            And I should see "s3 student (group3)" in the "#mail_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#mail_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#mail_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#mail_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#mail_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
            And I should see "s2 student (group2)" in the "#mail_users" "css_element"
            And I should see "s3 student (group3)" in the "#mail_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t5 teacher (Not in a group)" in the "#mail_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t5 teacher (Not in a group)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#mail_users" "css_element"
            And I should see "s2 student (group2)" in the "#mail_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#mail_users" "css_element"
            And I should see "s3 student (group3)" in the "#mail_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#mail_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#mail_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
            And I should see "s2 student (group2)" in the "#mail_users" "css_element"
            And I should see "s3 student (group3)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I log out

        And I log in as "s4"
        And I follow "Course One"
        When I click on "Compose New Email" "link" in the "Quickmail" "block"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#mail_users" "css_element"
            And I should see "t4 editingteacher (group1,group2)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t4 editingteacher (group1,group2)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#mail_users" "css_element"
            And I should see "t4 editingteacher (group1,group2)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "t4 editingteacher (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|group2|
            And I press "Add"
            And I should see "t2 teacher (group2)" in the "#mail_users" "css_element"
            And I should see "t4 editingteacher (group1,group2)" in the "#mail_users" "css_element"
            And I should see "s2 student (group2)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|group2|
            And I press "Add"
            And I should see "t4 editingteacher (group1,group2)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|group2|
            And I press "Add"
            And I should see "t2 teacher (group2)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "t4 editingteacher (group1,group2)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|group2|
            And I press "Add"
            And I should see "s2 student (group2)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "t4 editingteacher (group1,group2)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#mail_users" "css_element"
            And I should see "t4 editingteacher (group1,group2)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#mail_users" "css_element"
            And I should see "s2 student (group2)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t4 editingteacher (group1,group2)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#mail_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#mail_users" "css_element"
            And I should see "t4 editingteacher (group1,group2)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s2 student (group2)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "t4 editingteacher (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "t4 editingteacher (group1,group2)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "t4 editingteacher (group1,group2)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "t4 editingteacher (group1,group2)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "t4 editingteacher (group1,group2)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#mail_users" "css_element"
            And I should see "t4 editingteacher (group1,group2)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#mail_users" "css_element"
            And I should see "s2 student (group2)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t4 editingteacher (group1,group2)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#mail_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#mail_users" "css_element"
            And I should see "t4 editingteacher (group1,group2)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s2 student (group2)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "t4 editingteacher (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I log out

        And I log in as "t5"
        And I follow "Course One"
        When I click on "Compose New Email" "link" in the "Quickmail" "block"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I log out



# Configuration details:
# Students globally allowed to use Quickmail.
# Globally enforcing separate groups always.
# unrecognized setting for groupsCourse.
# Students disallowed from using Quickmail at the course level.

Scenario: 26
    Given I log in as "admin"
        And I set the following administration settings values:
            |Allow students to use Quickmail|Yes|
            |FERPA Mode|Always Separate Groups|
        And I log out

        And I log in as "t4"
        And I follow "Course One"
        And I click on "Configuration" "link" in the "Quickmail" "block"
        And I set the following fields to these values:
            |Allow students to use Quickmail|No|
        And I press "Save changes"
        And I log out


        And I log in as "t1"
        And I follow "Course One"
        When I click on "Compose New Email" "link" in the "Quickmail" "block"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t4 editingteacher (group1)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t4 editingteacher (group1)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t4 editingteacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1)" in the "#mail_users" "css_element"
            And I should see "t4 editingteacher (group1)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t4 editingteacher (group1)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t4 editingteacher (group1)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t4 editingteacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1)" in the "#mail_users" "css_element"
            And I should see "t4 editingteacher (group1)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t4 editingteacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t4 editingteacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t4 editingteacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t4 editingteacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t4 editingteacher (group1)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t4 editingteacher (group1)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t4 editingteacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1)" in the "#mail_users" "css_element"
            And I should see "t4 editingteacher (group1)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I log out

        And I log in as "t4"
        And I follow "Course One"
        When I click on "Compose New Email" "link" in the "Quickmail" "block"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|group2|
            And I press "Add"
            And I should see "t2 teacher (group2)" in the "#mail_users" "css_element"
            And I should see "s2 student (group2)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|group2|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|group2|
            And I press "Add"
            And I should see "t2 teacher (group2)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|group2|
            And I press "Add"
            And I should see "s2 student (group2)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|group3|
            And I press "Add"
            And I should see "t3 teacher (group3)" in the "#mail_users" "css_element"
            And I should see "s3 student (group3)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|group3|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|group3|
            And I press "Add"
            And I should see "t3 teacher (group3)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|group3|
            And I press "Add"
            And I should see "s3 student (group3)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#mail_users" "css_element"
            And I should see "s2 student (group2)" in the "#mail_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#mail_users" "css_element"
            And I should see "s3 student (group3)" in the "#mail_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#mail_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#mail_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#mail_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#mail_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
            And I should see "s2 student (group2)" in the "#mail_users" "css_element"
            And I should see "s3 student (group3)" in the "#mail_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t5 teacher (Not in a group)" in the "#mail_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t5 teacher (Not in a group)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#mail_users" "css_element"
            And I should see "s2 student (group2)" in the "#mail_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#mail_users" "css_element"
            And I should see "s3 student (group3)" in the "#mail_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#mail_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#mail_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
            And I should see "s2 student (group2)" in the "#mail_users" "css_element"
            And I should see "s3 student (group3)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I log out

        And I log in as "s4"
        And I follow "Course One"
        Then I should not see "Quickmail"
        And I log out

        And I log in as "t5"
        And I follow "Course One"
        When I click on "Compose New Email" "link" in the "Quickmail" "block"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I log out



# Configuration details:
# Students globally allowed to use Quickmail.
# Globally repsecting course group mode.
# 'No groups' set at course level.
# Students allowed to use Quickmail at the course level.

Scenario: 27
    Given I log in as "admin"
        And I set the following administration settings values:
            |Allow students to use Quickmail|Yes|
            |FERPA Mode|Respect Course Mode|
        And I log out

        And I log in as "t4"
        And I follow "Course One"
        And I follow "Edit settings"
		And I expand all fieldsets
        And I set the following fields to these values:
            |Group mode|No groups|
        And I press "Save changes"
        And I click on "Configuration" "link" in the "Quickmail" "block"
        And I set the following fields to these values:
            |Allow students to use Quickmail|Yes|
        And I press "Save changes"
        And I log out


        And I log in as "t1"
        And I follow "Course One"
        When I click on "Compose New Email" "link" in the "Quickmail" "block"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t4 editingteacher" in the "#mail_users" "css_element"
            And I should see "s1 student" in the "#mail_users" "css_element"
            And I should see "s4 student" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t4 editingteacher" in the "#mail_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "s1 student" in the "#mail_users" "css_element"
            And I should see "s4 student" in the "#mail_users" "css_element"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t4 editingteacher" in the "#mail_users" "css_element"
            And I should see "s1 student" in the "#mail_users" "css_element"
            And I should see "s4 student" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t4 editingteacher" in the "#mail_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s1 student" in the "#mail_users" "css_element"
            And I should see "s4 student" in the "#mail_users" "css_element"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t4 editingteacher" in the "#mail_users" "css_element"
            And I should see "s1 student" in the "#mail_users" "css_element"
            And I should see "s4 student" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t4 editingteacher" in the "#mail_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s1 student" in the "#mail_users" "css_element"
            And I should see "s4 student" in the "#mail_users" "css_element"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I log out

        And I log in as "t4"
        And I follow "Course One"
        When I click on "Compose New Email" "link" in the "Quickmail" "block"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t1 teacher" in the "#mail_users" "css_element"
            And I should see "s1 student" in the "#mail_users" "css_element"
            And I should see "s4 student" in the "#mail_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t1 teacher" in the "#mail_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "s1 student" in the "#mail_users" "css_element"
            And I should see "s4 student" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|group2|
            And I press "Add"
            And I should see "t2 teacher" in the "#mail_users" "css_element"
            And I should see "s2 student" in the "#mail_users" "css_element"
            And I should see "s4 student" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|group2|
            And I press "Add"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|group2|
            And I press "Add"
            And I should see "t2 teacher" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|group2|
            And I press "Add"
            And I should see "s2 student" in the "#mail_users" "css_element"
            And I should see "s4 student" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|group3|
            And I press "Add"
            And I should see "t3 teacher" in the "#mail_users" "css_element"
            And I should see "s3 student" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|group3|
            And I press "Add"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|group3|
            And I press "Add"
            And I should see "t3 teacher" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|group3|
            And I press "Add"
            And I should see "s3 student" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t1 teacher" in the "#mail_users" "css_element"
            And I should see "s1 student" in the "#mail_users" "css_element"
            And I should see "s4 student" in the "#mail_users" "css_element"
            And I should see "t2 teacher" in the "#mail_users" "css_element"
            And I should see "s2 student" in the "#mail_users" "css_element"
            And I should see "t3 teacher" in the "#mail_users" "css_element"
            And I should see "s3 student" in the "#mail_users" "css_element"
            And I should see "t5 teacher" in the "#mail_users" "css_element"
            And I should see "s5 student" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t1 teacher" in the "#mail_users" "css_element"
            And I should see "t2 teacher" in the "#mail_users" "css_element"
            And I should see "t3 teacher" in the "#mail_users" "css_element"
            And I should see "t5 teacher" in the "#mail_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s1 student" in the "#mail_users" "css_element"
            And I should see "s4 student" in the "#mail_users" "css_element"
            And I should see "s2 student" in the "#mail_users" "css_element"
            And I should see "s3 student" in the "#mail_users" "css_element"
            And I should see "s5 student" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t5 teacher" in the "#mail_users" "css_element"
            And I should see "s5 student" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t5 teacher" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t1 teacher" in the "#mail_users" "css_element"
            And I should see "s1 student" in the "#mail_users" "css_element"
            And I should see "s4 student" in the "#mail_users" "css_element"
            And I should see "t2 teacher" in the "#mail_users" "css_element"
            And I should see "s2 student" in the "#mail_users" "css_element"
            And I should see "t3 teacher" in the "#mail_users" "css_element"
            And I should see "s3 student" in the "#mail_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t1 teacher" in the "#mail_users" "css_element"
            And I should see "t2 teacher" in the "#mail_users" "css_element"
            And I should see "t3 teacher" in the "#mail_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s1 student" in the "#mail_users" "css_element"
            And I should see "s4 student" in the "#mail_users" "css_element"
            And I should see "s2 student" in the "#mail_users" "css_element"
            And I should see "s3 student" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I log out

        And I log in as "s4"
        And I follow "Course One"
        When I click on "Compose New Email" "link" in the "Quickmail" "block"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t1 teacher" in the "#mail_users" "css_element"
            And I should see "t4 editingteacher" in the "#mail_users" "css_element"
            And I should see "s1 student" in the "#mail_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t4 editingteacher" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t1 teacher" in the "#mail_users" "css_element"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "s1 student" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|group2|
            And I press "Add"
            And I should see "t2 teacher" in the "#mail_users" "css_element"
            And I should see "t4 editingteacher" in the "#mail_users" "css_element"
            And I should see "s2 student" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|group2|
            And I press "Add"
            And I should see "t4 editingteacher" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|group2|
            And I press "Add"
            And I should see "t2 teacher" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|group2|
            And I press "Add"
            And I should see "s2 student" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t1 teacher" in the "#mail_users" "css_element"
            And I should see "t4 editingteacher" in the "#mail_users" "css_element"
            And I should see "s1 student" in the "#mail_users" "css_element"
            And I should see "t2 teacher" in the "#mail_users" "css_element"
            And I should see "s2 student" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t4 editingteacher" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t1 teacher" in the "#mail_users" "css_element"
            And I should see "t2 teacher" in the "#mail_users" "css_element"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s1 student" in the "#mail_users" "css_element"
            And I should see "s2 student" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t1 teacher" in the "#mail_users" "css_element"
            And I should see "t4 editingteacher" in the "#mail_users" "css_element"
            And I should see "s1 student" in the "#mail_users" "css_element"
            And I should see "t2 teacher" in the "#mail_users" "css_element"
            And I should see "s2 student" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t4 editingteacher" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t1 teacher" in the "#mail_users" "css_element"
            And I should see "t2 teacher" in the "#mail_users" "css_element"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s1 student" in the "#mail_users" "css_element"
            And I should see "s2 student" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I log out

        And I log in as "t5"
        And I follow "Course One"
        When I click on "Compose New Email" "link" in the "Quickmail" "block"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s5 student" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s5 student" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I log out



# Configuration details:
# Students globally allowed to use Quickmail.
# Globally repsecting course group mode.
# 'No groups' set at course level.
# Students disallowed from using Quickmail at the course level.

Scenario: 28
    Given I log in as "admin"
        And I set the following administration settings values:
            |Allow students to use Quickmail|Yes|
            |FERPA Mode|Respect Course Mode|
        And I log out

        And I log in as "t4"
        And I follow "Course One"
        And I follow "Edit settings"
		And I expand all fieldsets
        And I set the following fields to these values:
            |Group mode|No groups|
        And I press "Save changes"
        And I click on "Configuration" "link" in the "Quickmail" "block"
        And I set the following fields to these values:
            |Allow students to use Quickmail|No|
        And I press "Save changes"
        And I log out


        And I log in as "t1"
        And I follow "Course One"
        When I click on "Compose New Email" "link" in the "Quickmail" "block"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t4 editingteacher" in the "#mail_users" "css_element"
            And I should see "s1 student" in the "#mail_users" "css_element"
            And I should see "s4 student" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t4 editingteacher" in the "#mail_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "s1 student" in the "#mail_users" "css_element"
            And I should see "s4 student" in the "#mail_users" "css_element"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t4 editingteacher" in the "#mail_users" "css_element"
            And I should see "s1 student" in the "#mail_users" "css_element"
            And I should see "s4 student" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t4 editingteacher" in the "#mail_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s1 student" in the "#mail_users" "css_element"
            And I should see "s4 student" in the "#mail_users" "css_element"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t4 editingteacher" in the "#mail_users" "css_element"
            And I should see "s1 student" in the "#mail_users" "css_element"
            And I should see "s4 student" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t4 editingteacher" in the "#mail_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s1 student" in the "#mail_users" "css_element"
            And I should see "s4 student" in the "#mail_users" "css_element"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I log out

        And I log in as "t4"
        And I follow "Course One"
        When I click on "Compose New Email" "link" in the "Quickmail" "block"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t1 teacher" in the "#mail_users" "css_element"
            And I should see "s1 student" in the "#mail_users" "css_element"
            And I should see "s4 student" in the "#mail_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t1 teacher" in the "#mail_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "s1 student" in the "#mail_users" "css_element"
            And I should see "s4 student" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|group2|
            And I press "Add"
            And I should see "t2 teacher" in the "#mail_users" "css_element"
            And I should see "s2 student" in the "#mail_users" "css_element"
            And I should see "s4 student" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|group2|
            And I press "Add"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|group2|
            And I press "Add"
            And I should see "t2 teacher" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|group2|
            And I press "Add"
            And I should see "s2 student" in the "#mail_users" "css_element"
            And I should see "s4 student" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|group3|
            And I press "Add"
            And I should see "t3 teacher" in the "#mail_users" "css_element"
            And I should see "s3 student" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|group3|
            And I press "Add"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|group3|
            And I press "Add"
            And I should see "t3 teacher" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|group3|
            And I press "Add"
            And I should see "s3 student" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t1 teacher" in the "#mail_users" "css_element"
            And I should see "s1 student" in the "#mail_users" "css_element"
            And I should see "s4 student" in the "#mail_users" "css_element"
            And I should see "t2 teacher" in the "#mail_users" "css_element"
            And I should see "s2 student" in the "#mail_users" "css_element"
            And I should see "t3 teacher" in the "#mail_users" "css_element"
            And I should see "s3 student" in the "#mail_users" "css_element"
            And I should see "t5 teacher" in the "#mail_users" "css_element"
            And I should see "s5 student" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t1 teacher" in the "#mail_users" "css_element"
            And I should see "t2 teacher" in the "#mail_users" "css_element"
            And I should see "t3 teacher" in the "#mail_users" "css_element"
            And I should see "t5 teacher" in the "#mail_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s1 student" in the "#mail_users" "css_element"
            And I should see "s4 student" in the "#mail_users" "css_element"
            And I should see "s2 student" in the "#mail_users" "css_element"
            And I should see "s3 student" in the "#mail_users" "css_element"
            And I should see "s5 student" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t5 teacher" in the "#mail_users" "css_element"
            And I should see "s5 student" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t5 teacher" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t1 teacher" in the "#mail_users" "css_element"
            And I should see "s1 student" in the "#mail_users" "css_element"
            And I should see "s4 student" in the "#mail_users" "css_element"
            And I should see "t2 teacher" in the "#mail_users" "css_element"
            And I should see "s2 student" in the "#mail_users" "css_element"
            And I should see "t3 teacher" in the "#mail_users" "css_element"
            And I should see "s3 student" in the "#mail_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t1 teacher" in the "#mail_users" "css_element"
            And I should see "t2 teacher" in the "#mail_users" "css_element"
            And I should see "t3 teacher" in the "#mail_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s1 student" in the "#mail_users" "css_element"
            And I should see "s4 student" in the "#mail_users" "css_element"
            And I should see "s2 student" in the "#mail_users" "css_element"
            And I should see "s3 student" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I log out

        And I log in as "s4"
        And I follow "Course One"
        Then I should not see "Quickmail"
        And I log out

        And I log in as "t5"
        And I follow "Course One"
        When I click on "Compose New Email" "link" in the "Quickmail" "block"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s5 student" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s5 student" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I log out



# Configuration details:
# Students globally allowed to use Quickmail.
# Globally repsecting course group mode.
# 'separate groups' set at the course level.
# Students allowed to use Quickmail at the course level.

Scenario: 29
    Given I log in as "admin"
        And I set the following administration settings values:
            |Allow students to use Quickmail|Yes|
            |FERPA Mode|Respect Course Mode|
        And I log out

        And I log in as "t4"
        And I follow "Course One"
        And I follow "Edit settings"
		And I expand all fieldsets
        And I set the following fields to these values:
            |Group mode|Separate groups|
        And I press "Save changes"
        And I click on "Configuration" "link" in the "Quickmail" "block"
        And I set the following fields to these values:
            |Allow students to use Quickmail|Yes|
        And I press "Save changes"
        And I log out


        And I log in as "t1"
        And I follow "Course One"
        When I click on "Compose New Email" "link" in the "Quickmail" "block"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t4 editingteacher (group1)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t4 editingteacher (group1)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t4 editingteacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1)" in the "#mail_users" "css_element"
            And I should see "t4 editingteacher (group1)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t4 editingteacher (group1)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t4 editingteacher (group1)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t4 editingteacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1)" in the "#mail_users" "css_element"
            And I should see "t4 editingteacher (group1)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t4 editingteacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t4 editingteacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t4 editingteacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t4 editingteacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t4 editingteacher (group1)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t4 editingteacher (group1)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t4 editingteacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1)" in the "#mail_users" "css_element"
            And I should see "t4 editingteacher (group1)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I log out

        And I log in as "t4"
        And I follow "Course One"
        When I click on "Compose New Email" "link" in the "Quickmail" "block"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|group2|
            And I press "Add"
            And I should see "t2 teacher (group2)" in the "#mail_users" "css_element"
            And I should see "s2 student (group2)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|group2|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|group2|
            And I press "Add"
            And I should see "t2 teacher (group2)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|group2|
            And I press "Add"
            And I should see "s2 student (group2)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|group3|
            And I press "Add"
            And I should see "t3 teacher (group3)" in the "#mail_users" "css_element"
            And I should see "s3 student (group3)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|group3|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|group3|
            And I press "Add"
            And I should see "t3 teacher (group3)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|group3|
            And I press "Add"
            And I should see "s3 student (group3)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#mail_users" "css_element"
            And I should see "s2 student (group2)" in the "#mail_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#mail_users" "css_element"
            And I should see "s3 student (group3)" in the "#mail_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#mail_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#mail_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#mail_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#mail_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
            And I should see "s2 student (group2)" in the "#mail_users" "css_element"
            And I should see "s3 student (group3)" in the "#mail_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t5 teacher (Not in a group)" in the "#mail_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t5 teacher (Not in a group)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#mail_users" "css_element"
            And I should see "s2 student (group2)" in the "#mail_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#mail_users" "css_element"
            And I should see "s3 student (group3)" in the "#mail_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#mail_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#mail_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
            And I should see "s2 student (group2)" in the "#mail_users" "css_element"
            And I should see "s3 student (group3)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I log out

        And I log in as "s4"
        And I follow "Course One"
        When I click on "Compose New Email" "link" in the "Quickmail" "block"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#mail_users" "css_element"
            And I should see "t4 editingteacher (group1,group2)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t4 editingteacher (group1,group2)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#mail_users" "css_element"
            And I should see "t4 editingteacher (group1,group2)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "t4 editingteacher (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|group2|
            And I press "Add"
            And I should see "t2 teacher (group2)" in the "#mail_users" "css_element"
            And I should see "t4 editingteacher (group1,group2)" in the "#mail_users" "css_element"
            And I should see "s2 student (group2)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|group2|
            And I press "Add"
            And I should see "t4 editingteacher (group1,group2)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|group2|
            And I press "Add"
            And I should see "t2 teacher (group2)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "t4 editingteacher (group1,group2)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|group2|
            And I press "Add"
            And I should see "s2 student (group2)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "t4 editingteacher (group1,group2)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#mail_users" "css_element"
            And I should see "t4 editingteacher (group1,group2)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#mail_users" "css_element"
            And I should see "s2 student (group2)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t4 editingteacher (group1,group2)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#mail_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#mail_users" "css_element"
            And I should see "t4 editingteacher (group1,group2)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s2 student (group2)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "t4 editingteacher (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "t4 editingteacher (group1,group2)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "t4 editingteacher (group1,group2)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "t4 editingteacher (group1,group2)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "t4 editingteacher (group1,group2)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#mail_users" "css_element"
            And I should see "t4 editingteacher (group1,group2)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#mail_users" "css_element"
            And I should see "s2 student (group2)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t4 editingteacher (group1,group2)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#mail_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#mail_users" "css_element"
            And I should see "t4 editingteacher (group1,group2)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s2 student (group2)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "t4 editingteacher (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I log out

        And I log in as "t5"
        And I follow "Course One"
        When I click on "Compose New Email" "link" in the "Quickmail" "block"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I log out



# Configuration details:
# Students globally allowed to use Quickmail.
# Globally repsecting course group mode.
# 'separate groups' set at the course level.
# Students disallowed from using Quickmail at the course level.

Scenario: 30
    Given I log in as "admin"
        And I set the following administration settings values:
            |Allow students to use Quickmail|Yes|
            |FERPA Mode|Respect Course Mode|
        And I log out

        And I log in as "t4"
        And I follow "Course One"
        And I follow "Edit settings"
		And I expand all fieldsets
        And I set the following fields to these values:
            |Group mode|Separate groups|
        And I press "Save changes"
        And I click on "Configuration" "link" in the "Quickmail" "block"
        And I set the following fields to these values:
            |Allow students to use Quickmail|No|
        And I press "Save changes"
        And I log out


        And I log in as "t1"
        And I follow "Course One"
        When I click on "Compose New Email" "link" in the "Quickmail" "block"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t4 editingteacher (group1)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t4 editingteacher (group1)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t4 editingteacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1)" in the "#mail_users" "css_element"
            And I should see "t4 editingteacher (group1)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t4 editingteacher (group1)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t4 editingteacher (group1)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t4 editingteacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1)" in the "#mail_users" "css_element"
            And I should see "t4 editingteacher (group1)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t4 editingteacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t4 editingteacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t4 editingteacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t4 editingteacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t4 editingteacher (group1)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t4 editingteacher (group1)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t4 editingteacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1)" in the "#mail_users" "css_element"
            And I should see "t4 editingteacher (group1)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I log out

        And I log in as "t4"
        And I follow "Course One"
        When I click on "Compose New Email" "link" in the "Quickmail" "block"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|group2|
            And I press "Add"
            And I should see "t2 teacher (group2)" in the "#mail_users" "css_element"
            And I should see "s2 student (group2)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|group2|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|group2|
            And I press "Add"
            And I should see "t2 teacher (group2)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|group2|
            And I press "Add"
            And I should see "s2 student (group2)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|group3|
            And I press "Add"
            And I should see "t3 teacher (group3)" in the "#mail_users" "css_element"
            And I should see "s3 student (group3)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|group3|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|group3|
            And I press "Add"
            And I should see "t3 teacher (group3)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|group3|
            And I press "Add"
            And I should see "s3 student (group3)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#mail_users" "css_element"
            And I should see "s2 student (group2)" in the "#mail_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#mail_users" "css_element"
            And I should see "s3 student (group3)" in the "#mail_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#mail_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#mail_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#mail_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#mail_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
            And I should see "s2 student (group2)" in the "#mail_users" "css_element"
            And I should see "s3 student (group3)" in the "#mail_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t5 teacher (Not in a group)" in the "#mail_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t5 teacher (Not in a group)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#mail_users" "css_element"
            And I should see "s2 student (group2)" in the "#mail_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#mail_users" "css_element"
            And I should see "s3 student (group3)" in the "#mail_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#mail_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#mail_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
            And I should see "s2 student (group2)" in the "#mail_users" "css_element"
            And I should see "s3 student (group3)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I log out

        And I log in as "s4"
        And I follow "Course One"
        Then I should not see "Quickmail"
        And I log out

        And I log in as "t5"
        And I follow "Course One"
        When I click on "Compose New Email" "link" in the "Quickmail" "block"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I log out



# Configuration details:
# Students globally allowed to use Quickmail.
# Globally repsecting course group mode.
# Groups set to 'visible' at the course level.
# Students allowed to use Quickmail at the course level.

Scenario: 31
    Given I log in as "admin"
        And I set the following administration settings values:
            |Allow students to use Quickmail|Yes|
            |FERPA Mode|Respect Course Mode|
        And I log out

        And I log in as "t4"
        And I follow "Course One"
        And I follow "Edit settings"
		And I expand all fieldsets
        And I set the following fields to these values:
            |Group mode|Visible groups|
        And I press "Save changes"
        And I click on "Configuration" "link" in the "Quickmail" "block"
        And I set the following fields to these values:
            |Allow students to use Quickmail|Yes|
        And I press "Save changes"
        And I log out


        And I log in as "t1"
        And I follow "Course One"
        When I click on "Compose New Email" "link" in the "Quickmail" "block"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t4 editingteacher (group1,group2,group3)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t4 editingteacher (group1,group2,group3)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t4 editingteacher (group1,group2,group3)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
            And I should see "t4 editingteacher (group1,group2,group3)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t4 editingteacher (group1,group2,group3)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t4 editingteacher (group1,group2,group3)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t4 editingteacher (group1,group2,group3)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
            And I should see "t4 editingteacher (group1,group2,group3)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t4 editingteacher (group1,group2,group3)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t4 editingteacher (group1,group2,group3)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t4 editingteacher (group1,group2,group3)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t4 editingteacher (group1,group2,group3)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t4 editingteacher (group1,group2,group3)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t4 editingteacher (group1,group2,group3)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t4 editingteacher (group1,group2,group3)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
            And I should see "t4 editingteacher (group1,group2,group3)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I log out

        And I log in as "t4"
        And I follow "Course One"
        When I click on "Compose New Email" "link" in the "Quickmail" "block"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|group2|
            And I press "Add"
            And I should see "t2 teacher (group2)" in the "#mail_users" "css_element"
            And I should see "s2 student (group2)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|group2|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|group2|
            And I press "Add"
            And I should see "t2 teacher (group2)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|group2|
            And I press "Add"
            And I should see "s2 student (group2)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|group3|
            And I press "Add"
            And I should see "t3 teacher (group3)" in the "#mail_users" "css_element"
            And I should see "s3 student (group3)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|group3|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|group3|
            And I press "Add"
            And I should see "t3 teacher (group3)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|group3|
            And I press "Add"
            And I should see "s3 student (group3)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#mail_users" "css_element"
            And I should see "s2 student (group2)" in the "#mail_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#mail_users" "css_element"
            And I should see "s3 student (group3)" in the "#mail_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#mail_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#mail_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#mail_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#mail_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
            And I should see "s2 student (group2)" in the "#mail_users" "css_element"
            And I should see "s3 student (group3)" in the "#mail_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t5 teacher (Not in a group)" in the "#mail_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t5 teacher (Not in a group)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#mail_users" "css_element"
            And I should see "s2 student (group2)" in the "#mail_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#mail_users" "css_element"
            And I should see "s3 student (group3)" in the "#mail_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#mail_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#mail_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
            And I should see "s2 student (group2)" in the "#mail_users" "css_element"
            And I should see "s3 student (group3)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I log out

        And I log in as "s4"
        And I follow "Course One"
        When I click on "Compose New Email" "link" in the "Quickmail" "block"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#mail_users" "css_element"
            And I should see "t4 editingteacher (group1,group2,group3)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t4 editingteacher (group1,group2,group3)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#mail_users" "css_element"
            And I should see "t4 editingteacher (group1,group2,group3)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "t4 editingteacher (group1,group2,group3)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|group2|
            And I press "Add"
            And I should see "t2 teacher (group2)" in the "#mail_users" "css_element"
            And I should see "t4 editingteacher (group1,group2,group3)" in the "#mail_users" "css_element"
            And I should see "s2 student (group2)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|group2|
            And I press "Add"
            And I should see "t4 editingteacher (group1,group2,group3)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|group2|
            And I press "Add"
            And I should see "t2 teacher (group2)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "t4 editingteacher (group1,group2,group3)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|group2|
            And I press "Add"
            And I should see "s2 student (group2)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "t4 editingteacher (group1,group2,group3)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#mail_users" "css_element"
            And I should see "t4 editingteacher (group1,group2,group3)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#mail_users" "css_element"
            And I should see "s2 student (group2)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t4 editingteacher (group1,group2,group3)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#mail_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#mail_users" "css_element"
            And I should see "t4 editingteacher (group1,group2,group3)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s2 student (group2)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "t4 editingteacher (group1,group2,group3)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "t4 editingteacher (group1,group2,group3)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "t4 editingteacher (group1,group2,group3)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "t4 editingteacher (group1,group2,group3)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "t4 editingteacher (group1,group2,group3)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#mail_users" "css_element"
            And I should see "t4 editingteacher (group1,group2,group3)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#mail_users" "css_element"
            And I should see "s2 student (group2)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t4 editingteacher (group1,group2,group3)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#mail_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#mail_users" "css_element"
            And I should see "t4 editingteacher (group1,group2,group3)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s2 student (group2)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "t4 editingteacher (group1,group2,group3)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I log out

        And I log in as "t5"
        And I follow "Course One"
        When I click on "Compose New Email" "link" in the "Quickmail" "block"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I log out



# Configuration details:
# Students globally allowed to use Quickmail.
# Globally repsecting course group mode.
# Groups set to 'visible' at the course level.
# Students disallowed from using Quickmail at the course level.

Scenario: 32
    Given I log in as "admin"
        And I set the following administration settings values:
            |Allow students to use Quickmail|Yes|
            |FERPA Mode|Respect Course Mode|
        And I log out

        And I log in as "t4"
        And I follow "Course One"
        And I follow "Edit settings"
		And I expand all fieldsets
        And I set the following fields to these values:
            |Group mode|Visible groups|
        And I press "Save changes"
        And I click on "Configuration" "link" in the "Quickmail" "block"
        And I set the following fields to these values:
            |Allow students to use Quickmail|No|
        And I press "Save changes"
        And I log out


        And I log in as "t1"
        And I follow "Course One"
        When I click on "Compose New Email" "link" in the "Quickmail" "block"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t4 editingteacher (group1,group2,group3)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t4 editingteacher (group1,group2,group3)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t4 editingteacher (group1,group2,group3)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
            And I should see "t4 editingteacher (group1,group2,group3)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t4 editingteacher (group1,group2,group3)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t4 editingteacher (group1,group2,group3)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t4 editingteacher (group1,group2,group3)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
            And I should see "t4 editingteacher (group1,group2,group3)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t4 editingteacher (group1,group2,group3)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t4 editingteacher (group1,group2,group3)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t4 editingteacher (group1,group2,group3)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t4 editingteacher (group1,group2,group3)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t4 editingteacher (group1,group2,group3)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t4 editingteacher (group1,group2,group3)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t4 editingteacher (group1,group2,group3)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
            And I should see "t4 editingteacher (group1,group2,group3)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I log out

        And I log in as "t4"
        And I follow "Course One"
        When I click on "Compose New Email" "link" in the "Quickmail" "block"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|group2|
            And I press "Add"
            And I should see "t2 teacher (group2)" in the "#mail_users" "css_element"
            And I should see "s2 student (group2)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|group2|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|group2|
            And I press "Add"
            And I should see "t2 teacher (group2)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|group2|
            And I press "Add"
            And I should see "s2 student (group2)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|group3|
            And I press "Add"
            And I should see "t3 teacher (group3)" in the "#mail_users" "css_element"
            And I should see "s3 student (group3)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|group3|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|group3|
            And I press "Add"
            And I should see "t3 teacher (group3)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|group3|
            And I press "Add"
            And I should see "s3 student (group3)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#mail_users" "css_element"
            And I should see "s2 student (group2)" in the "#mail_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#mail_users" "css_element"
            And I should see "s3 student (group3)" in the "#mail_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#mail_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#mail_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#mail_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#mail_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
            And I should see "s2 student (group2)" in the "#mail_users" "css_element"
            And I should see "s3 student (group3)" in the "#mail_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t5 teacher (Not in a group)" in the "#mail_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t5 teacher (Not in a group)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#mail_users" "css_element"
            And I should see "s2 student (group2)" in the "#mail_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#mail_users" "css_element"
            And I should see "s3 student (group3)" in the "#mail_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#mail_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#mail_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
            And I should see "s2 student (group2)" in the "#mail_users" "css_element"
            And I should see "s3 student (group3)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I log out

        And I log in as "s4"
        And I follow "Course One"
        Then I should not see "Quickmail"
        And I log out

        And I log in as "t5"
        And I follow "Course One"
        When I click on "Compose New Email" "link" in the "Quickmail" "block"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I log out



# Configuration details:
# Students globally allowed to use Quickmail.
# Globally ignoring groups
# unrecognized setting for groupsCourse.
# Students allowed to use Quickmail at the course level.

Scenario: 33
    Given I log in as "admin"
        And I set the following administration settings values:
            |Allow students to use Quickmail|Yes|
            |FERPA Mode|No Group Respect|
        And I log out

        And I log in as "t4"
        And I follow "Course One"
        And I click on "Configuration" "link" in the "Quickmail" "block"
        And I set the following fields to these values:
            |Allow students to use Quickmail|Yes|
        And I press "Save changes"
        And I log out


        And I log in as "t1"
        And I follow "Course One"
        When I click on "Compose New Email" "link" in the "Quickmail" "block"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t4 editingteacher" in the "#mail_users" "css_element"
            And I should see "s1 student" in the "#mail_users" "css_element"
            And I should see "s4 student" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t4 editingteacher" in the "#mail_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "s1 student" in the "#mail_users" "css_element"
            And I should see "s4 student" in the "#mail_users" "css_element"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t4 editingteacher" in the "#mail_users" "css_element"
            And I should see "s1 student" in the "#mail_users" "css_element"
            And I should see "s4 student" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t4 editingteacher" in the "#mail_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s1 student" in the "#mail_users" "css_element"
            And I should see "s4 student" in the "#mail_users" "css_element"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t4 editingteacher" in the "#mail_users" "css_element"
            And I should see "s1 student" in the "#mail_users" "css_element"
            And I should see "s4 student" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t4 editingteacher" in the "#mail_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s1 student" in the "#mail_users" "css_element"
            And I should see "s4 student" in the "#mail_users" "css_element"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I log out

        And I log in as "t4"
        And I follow "Course One"
        When I click on "Compose New Email" "link" in the "Quickmail" "block"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t1 teacher" in the "#mail_users" "css_element"
            And I should see "s1 student" in the "#mail_users" "css_element"
            And I should see "s4 student" in the "#mail_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t1 teacher" in the "#mail_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "s1 student" in the "#mail_users" "css_element"
            And I should see "s4 student" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|group2|
            And I press "Add"
            And I should see "t2 teacher" in the "#mail_users" "css_element"
            And I should see "s2 student" in the "#mail_users" "css_element"
            And I should see "s4 student" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|group2|
            And I press "Add"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|group2|
            And I press "Add"
            And I should see "t2 teacher" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|group2|
            And I press "Add"
            And I should see "s2 student" in the "#mail_users" "css_element"
            And I should see "s4 student" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|group3|
            And I press "Add"
            And I should see "t3 teacher" in the "#mail_users" "css_element"
            And I should see "s3 student" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|group3|
            And I press "Add"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|group3|
            And I press "Add"
            And I should see "t3 teacher" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|group3|
            And I press "Add"
            And I should see "s3 student" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t1 teacher" in the "#mail_users" "css_element"
            And I should see "s1 student" in the "#mail_users" "css_element"
            And I should see "s4 student" in the "#mail_users" "css_element"
            And I should see "t2 teacher" in the "#mail_users" "css_element"
            And I should see "s2 student" in the "#mail_users" "css_element"
            And I should see "t3 teacher" in the "#mail_users" "css_element"
            And I should see "s3 student" in the "#mail_users" "css_element"
            And I should see "t5 teacher" in the "#mail_users" "css_element"
            And I should see "s5 student" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t1 teacher" in the "#mail_users" "css_element"
            And I should see "t2 teacher" in the "#mail_users" "css_element"
            And I should see "t3 teacher" in the "#mail_users" "css_element"
            And I should see "t5 teacher" in the "#mail_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s1 student" in the "#mail_users" "css_element"
            And I should see "s4 student" in the "#mail_users" "css_element"
            And I should see "s2 student" in the "#mail_users" "css_element"
            And I should see "s3 student" in the "#mail_users" "css_element"
            And I should see "s5 student" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t5 teacher" in the "#mail_users" "css_element"
            And I should see "s5 student" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t5 teacher" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t1 teacher" in the "#mail_users" "css_element"
            And I should see "s1 student" in the "#mail_users" "css_element"
            And I should see "s4 student" in the "#mail_users" "css_element"
            And I should see "t2 teacher" in the "#mail_users" "css_element"
            And I should see "s2 student" in the "#mail_users" "css_element"
            And I should see "t3 teacher" in the "#mail_users" "css_element"
            And I should see "s3 student" in the "#mail_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t1 teacher" in the "#mail_users" "css_element"
            And I should see "t2 teacher" in the "#mail_users" "css_element"
            And I should see "t3 teacher" in the "#mail_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s1 student" in the "#mail_users" "css_element"
            And I should see "s4 student" in the "#mail_users" "css_element"
            And I should see "s2 student" in the "#mail_users" "css_element"
            And I should see "s3 student" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I log out

        And I log in as "s4"
        And I follow "Course One"
        When I click on "Compose New Email" "link" in the "Quickmail" "block"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t1 teacher" in the "#mail_users" "css_element"
            And I should see "t4 editingteacher" in the "#mail_users" "css_element"
            And I should see "s1 student" in the "#mail_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t4 editingteacher" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t1 teacher" in the "#mail_users" "css_element"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "s1 student" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|group2|
            And I press "Add"
            And I should see "t2 teacher" in the "#mail_users" "css_element"
            And I should see "t4 editingteacher" in the "#mail_users" "css_element"
            And I should see "s2 student" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|group2|
            And I press "Add"
            And I should see "t4 editingteacher" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|group2|
            And I press "Add"
            And I should see "t2 teacher" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|group2|
            And I press "Add"
            And I should see "s2 student" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t1 teacher" in the "#mail_users" "css_element"
            And I should see "t4 editingteacher" in the "#mail_users" "css_element"
            And I should see "s1 student" in the "#mail_users" "css_element"
            And I should see "t2 teacher" in the "#mail_users" "css_element"
            And I should see "s2 student" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t4 editingteacher" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t1 teacher" in the "#mail_users" "css_element"
            And I should see "t2 teacher" in the "#mail_users" "css_element"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s1 student" in the "#mail_users" "css_element"
            And I should see "s2 student" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t1 teacher" in the "#mail_users" "css_element"
            And I should see "t4 editingteacher" in the "#mail_users" "css_element"
            And I should see "s1 student" in the "#mail_users" "css_element"
            And I should see "t2 teacher" in the "#mail_users" "css_element"
            And I should see "s2 student" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t4 editingteacher" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t1 teacher" in the "#mail_users" "css_element"
            And I should see "t2 teacher" in the "#mail_users" "css_element"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s1 student" in the "#mail_users" "css_element"
            And I should see "s2 student" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I log out

        And I log in as "t5"
        And I follow "Course One"
        When I click on "Compose New Email" "link" in the "Quickmail" "block"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s5 student" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s5 student" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I log out



# Configuration details:
# Students globally allowed to use Quickmail.
# Globally ignoring groups
# unrecognized setting for groupsCourse.
# Students disallowed from using Quickmail at the course level.

Scenario: 34
    Given I log in as "admin"
        And I set the following administration settings values:
            |Allow students to use Quickmail|Yes|
            |FERPA Mode|No Group Respect|
        And I log out

        And I log in as "t4"
        And I follow "Course One"
        And I click on "Configuration" "link" in the "Quickmail" "block"
        And I set the following fields to these values:
            |Allow students to use Quickmail|No|
        And I press "Save changes"
        And I log out


        And I log in as "t1"
        And I follow "Course One"
        When I click on "Compose New Email" "link" in the "Quickmail" "block"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t4 editingteacher" in the "#mail_users" "css_element"
            And I should see "s1 student" in the "#mail_users" "css_element"
            And I should see "s4 student" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t4 editingteacher" in the "#mail_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "s1 student" in the "#mail_users" "css_element"
            And I should see "s4 student" in the "#mail_users" "css_element"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t4 editingteacher" in the "#mail_users" "css_element"
            And I should see "s1 student" in the "#mail_users" "css_element"
            And I should see "s4 student" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t4 editingteacher" in the "#mail_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s1 student" in the "#mail_users" "css_element"
            And I should see "s4 student" in the "#mail_users" "css_element"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t4 editingteacher" in the "#mail_users" "css_element"
            And I should see "s1 student" in the "#mail_users" "css_element"
            And I should see "s4 student" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t4 editingteacher" in the "#mail_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s1 student" in the "#mail_users" "css_element"
            And I should see "s4 student" in the "#mail_users" "css_element"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I log out

        And I log in as "t4"
        And I follow "Course One"
        When I click on "Compose New Email" "link" in the "Quickmail" "block"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t1 teacher" in the "#mail_users" "css_element"
            And I should see "s1 student" in the "#mail_users" "css_element"
            And I should see "s4 student" in the "#mail_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t1 teacher" in the "#mail_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "s1 student" in the "#mail_users" "css_element"
            And I should see "s4 student" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|group2|
            And I press "Add"
            And I should see "t2 teacher" in the "#mail_users" "css_element"
            And I should see "s2 student" in the "#mail_users" "css_element"
            And I should see "s4 student" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|group2|
            And I press "Add"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|group2|
            And I press "Add"
            And I should see "t2 teacher" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|group2|
            And I press "Add"
            And I should see "s2 student" in the "#mail_users" "css_element"
            And I should see "s4 student" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|group3|
            And I press "Add"
            And I should see "t3 teacher" in the "#mail_users" "css_element"
            And I should see "s3 student" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|group3|
            And I press "Add"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|group3|
            And I press "Add"
            And I should see "t3 teacher" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|group3|
            And I press "Add"
            And I should see "s3 student" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t1 teacher" in the "#mail_users" "css_element"
            And I should see "s1 student" in the "#mail_users" "css_element"
            And I should see "s4 student" in the "#mail_users" "css_element"
            And I should see "t2 teacher" in the "#mail_users" "css_element"
            And I should see "s2 student" in the "#mail_users" "css_element"
            And I should see "t3 teacher" in the "#mail_users" "css_element"
            And I should see "s3 student" in the "#mail_users" "css_element"
            And I should see "t5 teacher" in the "#mail_users" "css_element"
            And I should see "s5 student" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t1 teacher" in the "#mail_users" "css_element"
            And I should see "t2 teacher" in the "#mail_users" "css_element"
            And I should see "t3 teacher" in the "#mail_users" "css_element"
            And I should see "t5 teacher" in the "#mail_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s1 student" in the "#mail_users" "css_element"
            And I should see "s4 student" in the "#mail_users" "css_element"
            And I should see "s2 student" in the "#mail_users" "css_element"
            And I should see "s3 student" in the "#mail_users" "css_element"
            And I should see "s5 student" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t5 teacher" in the "#mail_users" "css_element"
            And I should see "s5 student" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t5 teacher" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t1 teacher" in the "#mail_users" "css_element"
            And I should see "s1 student" in the "#mail_users" "css_element"
            And I should see "s4 student" in the "#mail_users" "css_element"
            And I should see "t2 teacher" in the "#mail_users" "css_element"
            And I should see "s2 student" in the "#mail_users" "css_element"
            And I should see "t3 teacher" in the "#mail_users" "css_element"
            And I should see "s3 student" in the "#mail_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t1 teacher" in the "#mail_users" "css_element"
            And I should see "t2 teacher" in the "#mail_users" "css_element"
            And I should see "t3 teacher" in the "#mail_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s1 student" in the "#mail_users" "css_element"
            And I should see "s4 student" in the "#mail_users" "css_element"
            And I should see "s2 student" in the "#mail_users" "css_element"
            And I should see "s3 student" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I log out

        And I log in as "s4"
        And I follow "Course One"
        Then I should not see "Quickmail"
        And I log out

        And I log in as "t5"
        And I follow "Course One"
        When I click on "Compose New Email" "link" in the "Quickmail" "block"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s5 student" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s5 student" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I log out



# Configuration details:
# Students globally disallowed from using Quickmail.
# Globally enforcing separate groups always.
# unrecognized setting for groupsCourse.
# Students allowed to use Quickmail at the course level.

Scenario: 35
    Given I log in as "admin"
        And I set the following administration settings values:
            |Allow students to use Quickmail|No|
            |FERPA Mode|Always Separate Groups|
        And I log out

        And I log in as "t4"
        And I follow "Course One"
        And I click on "Configuration" "link" in the "Quickmail" "block"
        And I set the following fields to these values:
            |Allow students to use Quickmail|Yes|
        And I press "Save changes"
        And I log out


        And I log in as "t1"
        And I follow "Course One"
        When I click on "Compose New Email" "link" in the "Quickmail" "block"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t4 editingteacher (group1)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t4 editingteacher (group1)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t4 editingteacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1)" in the "#mail_users" "css_element"
            And I should see "t4 editingteacher (group1)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t4 editingteacher (group1)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t4 editingteacher (group1)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t4 editingteacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1)" in the "#mail_users" "css_element"
            And I should see "t4 editingteacher (group1)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t4 editingteacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t4 editingteacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t4 editingteacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t4 editingteacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t4 editingteacher (group1)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t4 editingteacher (group1)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t4 editingteacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1)" in the "#mail_users" "css_element"
            And I should see "t4 editingteacher (group1)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I log out

        And I log in as "t4"
        And I follow "Course One"
        When I click on "Compose New Email" "link" in the "Quickmail" "block"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|group2|
            And I press "Add"
            And I should see "t2 teacher (group2)" in the "#mail_users" "css_element"
            And I should see "s2 student (group2)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|group2|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|group2|
            And I press "Add"
            And I should see "t2 teacher (group2)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|group2|
            And I press "Add"
            And I should see "s2 student (group2)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|group3|
            And I press "Add"
            And I should see "t3 teacher (group3)" in the "#mail_users" "css_element"
            And I should see "s3 student (group3)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|group3|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|group3|
            And I press "Add"
            And I should see "t3 teacher (group3)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|group3|
            And I press "Add"
            And I should see "s3 student (group3)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#mail_users" "css_element"
            And I should see "s2 student (group2)" in the "#mail_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#mail_users" "css_element"
            And I should see "s3 student (group3)" in the "#mail_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#mail_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#mail_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#mail_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#mail_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
            And I should see "s2 student (group2)" in the "#mail_users" "css_element"
            And I should see "s3 student (group3)" in the "#mail_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t5 teacher (Not in a group)" in the "#mail_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t5 teacher (Not in a group)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#mail_users" "css_element"
            And I should see "s2 student (group2)" in the "#mail_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#mail_users" "css_element"
            And I should see "s3 student (group3)" in the "#mail_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#mail_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#mail_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
            And I should see "s2 student (group2)" in the "#mail_users" "css_element"
            And I should see "s3 student (group3)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I log out

        And I log in as "s4"
        And I follow "Course One"
        When I click on "Compose New Email" "link" in the "Quickmail" "block"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#mail_users" "css_element"
            And I should see "t4 editingteacher (group1,group2)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t4 editingteacher (group1,group2)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#mail_users" "css_element"
            And I should see "t4 editingteacher (group1,group2)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "t4 editingteacher (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|group2|
            And I press "Add"
            And I should see "t2 teacher (group2)" in the "#mail_users" "css_element"
            And I should see "t4 editingteacher (group1,group2)" in the "#mail_users" "css_element"
            And I should see "s2 student (group2)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|group2|
            And I press "Add"
            And I should see "t4 editingteacher (group1,group2)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|group2|
            And I press "Add"
            And I should see "t2 teacher (group2)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "t4 editingteacher (group1,group2)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|group2|
            And I press "Add"
            And I should see "s2 student (group2)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "t4 editingteacher (group1,group2)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#mail_users" "css_element"
            And I should see "t4 editingteacher (group1,group2)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#mail_users" "css_element"
            And I should see "s2 student (group2)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t4 editingteacher (group1,group2)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#mail_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#mail_users" "css_element"
            And I should see "t4 editingteacher (group1,group2)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s2 student (group2)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "t4 editingteacher (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "t4 editingteacher (group1,group2)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "t4 editingteacher (group1,group2)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "t4 editingteacher (group1,group2)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "t4 editingteacher (group1,group2)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#mail_users" "css_element"
            And I should see "t4 editingteacher (group1,group2)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#mail_users" "css_element"
            And I should see "s2 student (group2)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t4 editingteacher (group1,group2)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#mail_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#mail_users" "css_element"
            And I should see "t4 editingteacher (group1,group2)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s2 student (group2)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "t4 editingteacher (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I log out

        And I log in as "t5"
        And I follow "Course One"
        When I click on "Compose New Email" "link" in the "Quickmail" "block"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I log out



# Configuration details:
# Students globally disallowed from using Quickmail.
# Globally enforcing separate groups always.
# unrecognized setting for groupsCourse.
# Students disallowed from using Quickmail at the course level.

Scenario: 36
    Given I log in as "admin"
        And I set the following administration settings values:
            |Allow students to use Quickmail|No|
            |FERPA Mode|Always Separate Groups|
        And I log out

        And I log in as "t4"
        And I follow "Course One"
        And I click on "Configuration" "link" in the "Quickmail" "block"
        And I set the following fields to these values:
            |Allow students to use Quickmail|No|
        And I press "Save changes"
        And I log out


        And I log in as "t1"
        And I follow "Course One"
        When I click on "Compose New Email" "link" in the "Quickmail" "block"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t4 editingteacher (group1)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t4 editingteacher (group1)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t4 editingteacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1)" in the "#mail_users" "css_element"
            And I should see "t4 editingteacher (group1)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t4 editingteacher (group1)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t4 editingteacher (group1)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t4 editingteacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1)" in the "#mail_users" "css_element"
            And I should see "t4 editingteacher (group1)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t4 editingteacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t4 editingteacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t4 editingteacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t4 editingteacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t4 editingteacher (group1)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t4 editingteacher (group1)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t4 editingteacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1)" in the "#mail_users" "css_element"
            And I should see "t4 editingteacher (group1)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I log out

        And I log in as "t4"
        And I follow "Course One"
        When I click on "Compose New Email" "link" in the "Quickmail" "block"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|group2|
            And I press "Add"
            And I should see "t2 teacher (group2)" in the "#mail_users" "css_element"
            And I should see "s2 student (group2)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|group2|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|group2|
            And I press "Add"
            And I should see "t2 teacher (group2)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|group2|
            And I press "Add"
            And I should see "s2 student (group2)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|group3|
            And I press "Add"
            And I should see "t3 teacher (group3)" in the "#mail_users" "css_element"
            And I should see "s3 student (group3)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|group3|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|group3|
            And I press "Add"
            And I should see "t3 teacher (group3)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|group3|
            And I press "Add"
            And I should see "s3 student (group3)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#mail_users" "css_element"
            And I should see "s2 student (group2)" in the "#mail_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#mail_users" "css_element"
            And I should see "s3 student (group3)" in the "#mail_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#mail_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#mail_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#mail_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#mail_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
            And I should see "s2 student (group2)" in the "#mail_users" "css_element"
            And I should see "s3 student (group3)" in the "#mail_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t5 teacher (Not in a group)" in the "#mail_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t5 teacher (Not in a group)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#mail_users" "css_element"
            And I should see "s2 student (group2)" in the "#mail_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#mail_users" "css_element"
            And I should see "s3 student (group3)" in the "#mail_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#mail_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#mail_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
            And I should see "s2 student (group2)" in the "#mail_users" "css_element"
            And I should see "s3 student (group3)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I log out

        And I log in as "s4"
        And I follow "Course One"
        Then I should not see "Quickmail"
        And I log out

        And I log in as "t5"
        And I follow "Course One"
        When I click on "Compose New Email" "link" in the "Quickmail" "block"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I log out



# Configuration details:
# Students globally disallowed from using Quickmail.
# Globally repsecting course group mode.
# 'No groups' set at course level.
# Students allowed to use Quickmail at the course level.

Scenario: 37
    Given I log in as "admin"
        And I set the following administration settings values:
            |Allow students to use Quickmail|No|
            |FERPA Mode|Respect Course Mode|
        And I log out

        And I log in as "t4"
        And I follow "Course One"
        And I follow "Edit settings"
		And I expand all fieldsets
        And I set the following fields to these values:
            |Group mode|No groups|
        And I press "Save changes"
        And I click on "Configuration" "link" in the "Quickmail" "block"
        And I set the following fields to these values:
            |Allow students to use Quickmail|Yes|
        And I press "Save changes"
        And I log out


        And I log in as "t1"
        And I follow "Course One"
        When I click on "Compose New Email" "link" in the "Quickmail" "block"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t4 editingteacher" in the "#mail_users" "css_element"
            And I should see "s1 student" in the "#mail_users" "css_element"
            And I should see "s4 student" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t4 editingteacher" in the "#mail_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "s1 student" in the "#mail_users" "css_element"
            And I should see "s4 student" in the "#mail_users" "css_element"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t4 editingteacher" in the "#mail_users" "css_element"
            And I should see "s1 student" in the "#mail_users" "css_element"
            And I should see "s4 student" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t4 editingteacher" in the "#mail_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s1 student" in the "#mail_users" "css_element"
            And I should see "s4 student" in the "#mail_users" "css_element"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t4 editingteacher" in the "#mail_users" "css_element"
            And I should see "s1 student" in the "#mail_users" "css_element"
            And I should see "s4 student" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t4 editingteacher" in the "#mail_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s1 student" in the "#mail_users" "css_element"
            And I should see "s4 student" in the "#mail_users" "css_element"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I log out

        And I log in as "t4"
        And I follow "Course One"
        When I click on "Compose New Email" "link" in the "Quickmail" "block"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t1 teacher" in the "#mail_users" "css_element"
            And I should see "s1 student" in the "#mail_users" "css_element"
            And I should see "s4 student" in the "#mail_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t1 teacher" in the "#mail_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "s1 student" in the "#mail_users" "css_element"
            And I should see "s4 student" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|group2|
            And I press "Add"
            And I should see "t2 teacher" in the "#mail_users" "css_element"
            And I should see "s2 student" in the "#mail_users" "css_element"
            And I should see "s4 student" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|group2|
            And I press "Add"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|group2|
            And I press "Add"
            And I should see "t2 teacher" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|group2|
            And I press "Add"
            And I should see "s2 student" in the "#mail_users" "css_element"
            And I should see "s4 student" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|group3|
            And I press "Add"
            And I should see "t3 teacher" in the "#mail_users" "css_element"
            And I should see "s3 student" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|group3|
            And I press "Add"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|group3|
            And I press "Add"
            And I should see "t3 teacher" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|group3|
            And I press "Add"
            And I should see "s3 student" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t1 teacher" in the "#mail_users" "css_element"
            And I should see "s1 student" in the "#mail_users" "css_element"
            And I should see "s4 student" in the "#mail_users" "css_element"
            And I should see "t2 teacher" in the "#mail_users" "css_element"
            And I should see "s2 student" in the "#mail_users" "css_element"
            And I should see "t3 teacher" in the "#mail_users" "css_element"
            And I should see "s3 student" in the "#mail_users" "css_element"
            And I should see "t5 teacher" in the "#mail_users" "css_element"
            And I should see "s5 student" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t1 teacher" in the "#mail_users" "css_element"
            And I should see "t2 teacher" in the "#mail_users" "css_element"
            And I should see "t3 teacher" in the "#mail_users" "css_element"
            And I should see "t5 teacher" in the "#mail_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s1 student" in the "#mail_users" "css_element"
            And I should see "s4 student" in the "#mail_users" "css_element"
            And I should see "s2 student" in the "#mail_users" "css_element"
            And I should see "s3 student" in the "#mail_users" "css_element"
            And I should see "s5 student" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t5 teacher" in the "#mail_users" "css_element"
            And I should see "s5 student" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t5 teacher" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t1 teacher" in the "#mail_users" "css_element"
            And I should see "s1 student" in the "#mail_users" "css_element"
            And I should see "s4 student" in the "#mail_users" "css_element"
            And I should see "t2 teacher" in the "#mail_users" "css_element"
            And I should see "s2 student" in the "#mail_users" "css_element"
            And I should see "t3 teacher" in the "#mail_users" "css_element"
            And I should see "s3 student" in the "#mail_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t1 teacher" in the "#mail_users" "css_element"
            And I should see "t2 teacher" in the "#mail_users" "css_element"
            And I should see "t3 teacher" in the "#mail_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s1 student" in the "#mail_users" "css_element"
            And I should see "s4 student" in the "#mail_users" "css_element"
            And I should see "s2 student" in the "#mail_users" "css_element"
            And I should see "s3 student" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I log out

        And I log in as "s4"
        And I follow "Course One"
        When I click on "Compose New Email" "link" in the "Quickmail" "block"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t1 teacher" in the "#mail_users" "css_element"
            And I should see "t4 editingteacher" in the "#mail_users" "css_element"
            And I should see "s1 student" in the "#mail_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t4 editingteacher" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t1 teacher" in the "#mail_users" "css_element"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "s1 student" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|group2|
            And I press "Add"
            And I should see "t2 teacher" in the "#mail_users" "css_element"
            And I should see "t4 editingteacher" in the "#mail_users" "css_element"
            And I should see "s2 student" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|group2|
            And I press "Add"
            And I should see "t4 editingteacher" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|group2|
            And I press "Add"
            And I should see "t2 teacher" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|group2|
            And I press "Add"
            And I should see "s2 student" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t1 teacher" in the "#mail_users" "css_element"
            And I should see "t4 editingteacher" in the "#mail_users" "css_element"
            And I should see "s1 student" in the "#mail_users" "css_element"
            And I should see "t2 teacher" in the "#mail_users" "css_element"
            And I should see "s2 student" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t4 editingteacher" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t1 teacher" in the "#mail_users" "css_element"
            And I should see "t2 teacher" in the "#mail_users" "css_element"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s1 student" in the "#mail_users" "css_element"
            And I should see "s2 student" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t1 teacher" in the "#mail_users" "css_element"
            And I should see "t4 editingteacher" in the "#mail_users" "css_element"
            And I should see "s1 student" in the "#mail_users" "css_element"
            And I should see "t2 teacher" in the "#mail_users" "css_element"
            And I should see "s2 student" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t4 editingteacher" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t1 teacher" in the "#mail_users" "css_element"
            And I should see "t2 teacher" in the "#mail_users" "css_element"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s1 student" in the "#mail_users" "css_element"
            And I should see "s2 student" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I log out

        And I log in as "t5"
        And I follow "Course One"
        When I click on "Compose New Email" "link" in the "Quickmail" "block"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s5 student" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s5 student" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I log out



# Configuration details:
# Students globally disallowed from using Quickmail.
# Globally repsecting course group mode.
# 'No groups' set at course level.
# Students disallowed from using Quickmail at the course level.

Scenario: 38
    Given I log in as "admin"
        And I set the following administration settings values:
            |Allow students to use Quickmail|No|
            |FERPA Mode|Respect Course Mode|
        And I log out

        And I log in as "t4"
        And I follow "Course One"
        And I follow "Edit settings"
		And I expand all fieldsets
        And I set the following fields to these values:
            |Group mode|No groups|
        And I press "Save changes"
        And I click on "Configuration" "link" in the "Quickmail" "block"
        And I set the following fields to these values:
            |Allow students to use Quickmail|No|
        And I press "Save changes"
        And I log out


        And I log in as "t1"
        And I follow "Course One"
        When I click on "Compose New Email" "link" in the "Quickmail" "block"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t4 editingteacher" in the "#mail_users" "css_element"
            And I should see "s1 student" in the "#mail_users" "css_element"
            And I should see "s4 student" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t4 editingteacher" in the "#mail_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "s1 student" in the "#mail_users" "css_element"
            And I should see "s4 student" in the "#mail_users" "css_element"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t4 editingteacher" in the "#mail_users" "css_element"
            And I should see "s1 student" in the "#mail_users" "css_element"
            And I should see "s4 student" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t4 editingteacher" in the "#mail_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s1 student" in the "#mail_users" "css_element"
            And I should see "s4 student" in the "#mail_users" "css_element"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t4 editingteacher" in the "#mail_users" "css_element"
            And I should see "s1 student" in the "#mail_users" "css_element"
            And I should see "s4 student" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t4 editingteacher" in the "#mail_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s1 student" in the "#mail_users" "css_element"
            And I should see "s4 student" in the "#mail_users" "css_element"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I log out

        And I log in as "t4"
        And I follow "Course One"
        When I click on "Compose New Email" "link" in the "Quickmail" "block"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t1 teacher" in the "#mail_users" "css_element"
            And I should see "s1 student" in the "#mail_users" "css_element"
            And I should see "s4 student" in the "#mail_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t1 teacher" in the "#mail_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "s1 student" in the "#mail_users" "css_element"
            And I should see "s4 student" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|group2|
            And I press "Add"
            And I should see "t2 teacher" in the "#mail_users" "css_element"
            And I should see "s2 student" in the "#mail_users" "css_element"
            And I should see "s4 student" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|group2|
            And I press "Add"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|group2|
            And I press "Add"
            And I should see "t2 teacher" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|group2|
            And I press "Add"
            And I should see "s2 student" in the "#mail_users" "css_element"
            And I should see "s4 student" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|group3|
            And I press "Add"
            And I should see "t3 teacher" in the "#mail_users" "css_element"
            And I should see "s3 student" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|group3|
            And I press "Add"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|group3|
            And I press "Add"
            And I should see "t3 teacher" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|group3|
            And I press "Add"
            And I should see "s3 student" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t1 teacher" in the "#mail_users" "css_element"
            And I should see "s1 student" in the "#mail_users" "css_element"
            And I should see "s4 student" in the "#mail_users" "css_element"
            And I should see "t2 teacher" in the "#mail_users" "css_element"
            And I should see "s2 student" in the "#mail_users" "css_element"
            And I should see "t3 teacher" in the "#mail_users" "css_element"
            And I should see "s3 student" in the "#mail_users" "css_element"
            And I should see "t5 teacher" in the "#mail_users" "css_element"
            And I should see "s5 student" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t1 teacher" in the "#mail_users" "css_element"
            And I should see "t2 teacher" in the "#mail_users" "css_element"
            And I should see "t3 teacher" in the "#mail_users" "css_element"
            And I should see "t5 teacher" in the "#mail_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s1 student" in the "#mail_users" "css_element"
            And I should see "s4 student" in the "#mail_users" "css_element"
            And I should see "s2 student" in the "#mail_users" "css_element"
            And I should see "s3 student" in the "#mail_users" "css_element"
            And I should see "s5 student" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t5 teacher" in the "#mail_users" "css_element"
            And I should see "s5 student" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t5 teacher" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t1 teacher" in the "#mail_users" "css_element"
            And I should see "s1 student" in the "#mail_users" "css_element"
            And I should see "s4 student" in the "#mail_users" "css_element"
            And I should see "t2 teacher" in the "#mail_users" "css_element"
            And I should see "s2 student" in the "#mail_users" "css_element"
            And I should see "t3 teacher" in the "#mail_users" "css_element"
            And I should see "s3 student" in the "#mail_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t1 teacher" in the "#mail_users" "css_element"
            And I should see "t2 teacher" in the "#mail_users" "css_element"
            And I should see "t3 teacher" in the "#mail_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s1 student" in the "#mail_users" "css_element"
            And I should see "s4 student" in the "#mail_users" "css_element"
            And I should see "s2 student" in the "#mail_users" "css_element"
            And I should see "s3 student" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I log out

        And I log in as "s4"
        And I follow "Course One"
        Then I should not see "Quickmail"
        And I log out

        And I log in as "t5"
        And I follow "Course One"
        When I click on "Compose New Email" "link" in the "Quickmail" "block"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s5 student" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s5 student" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I log out



# Configuration details:
# Students globally disallowed from using Quickmail.
# Globally repsecting course group mode.
# 'separate groups' set at the course level.
# Students allowed to use Quickmail at the course level.

Scenario: 39
    Given I log in as "admin"
        And I set the following administration settings values:
            |Allow students to use Quickmail|No|
            |FERPA Mode|Respect Course Mode|
        And I log out

        And I log in as "t4"
        And I follow "Course One"
        And I follow "Edit settings"
		And I expand all fieldsets
        And I set the following fields to these values:
            |Group mode|Separate groups|
        And I press "Save changes"
        And I click on "Configuration" "link" in the "Quickmail" "block"
        And I set the following fields to these values:
            |Allow students to use Quickmail|Yes|
        And I press "Save changes"
        And I log out


        And I log in as "t1"
        And I follow "Course One"
        When I click on "Compose New Email" "link" in the "Quickmail" "block"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t4 editingteacher (group1)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t4 editingteacher (group1)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t4 editingteacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1)" in the "#mail_users" "css_element"
            And I should see "t4 editingteacher (group1)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t4 editingteacher (group1)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t4 editingteacher (group1)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t4 editingteacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1)" in the "#mail_users" "css_element"
            And I should see "t4 editingteacher (group1)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t4 editingteacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t4 editingteacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t4 editingteacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t4 editingteacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t4 editingteacher (group1)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t4 editingteacher (group1)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t4 editingteacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1)" in the "#mail_users" "css_element"
            And I should see "t4 editingteacher (group1)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I log out

        And I log in as "t4"
        And I follow "Course One"
        When I click on "Compose New Email" "link" in the "Quickmail" "block"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|group2|
            And I press "Add"
            And I should see "t2 teacher (group2)" in the "#mail_users" "css_element"
            And I should see "s2 student (group2)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|group2|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|group2|
            And I press "Add"
            And I should see "t2 teacher (group2)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|group2|
            And I press "Add"
            And I should see "s2 student (group2)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|group3|
            And I press "Add"
            And I should see "t3 teacher (group3)" in the "#mail_users" "css_element"
            And I should see "s3 student (group3)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|group3|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|group3|
            And I press "Add"
            And I should see "t3 teacher (group3)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|group3|
            And I press "Add"
            And I should see "s3 student (group3)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#mail_users" "css_element"
            And I should see "s2 student (group2)" in the "#mail_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#mail_users" "css_element"
            And I should see "s3 student (group3)" in the "#mail_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#mail_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#mail_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#mail_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#mail_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
            And I should see "s2 student (group2)" in the "#mail_users" "css_element"
            And I should see "s3 student (group3)" in the "#mail_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t5 teacher (Not in a group)" in the "#mail_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t5 teacher (Not in a group)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#mail_users" "css_element"
            And I should see "s2 student (group2)" in the "#mail_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#mail_users" "css_element"
            And I should see "s3 student (group3)" in the "#mail_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#mail_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#mail_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
            And I should see "s2 student (group2)" in the "#mail_users" "css_element"
            And I should see "s3 student (group3)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I log out

        And I log in as "s4"
        And I follow "Course One"
        When I click on "Compose New Email" "link" in the "Quickmail" "block"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#mail_users" "css_element"
            And I should see "t4 editingteacher (group1,group2)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t4 editingteacher (group1,group2)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#mail_users" "css_element"
            And I should see "t4 editingteacher (group1,group2)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "t4 editingteacher (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|group2|
            And I press "Add"
            And I should see "t2 teacher (group2)" in the "#mail_users" "css_element"
            And I should see "t4 editingteacher (group1,group2)" in the "#mail_users" "css_element"
            And I should see "s2 student (group2)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|group2|
            And I press "Add"
            And I should see "t4 editingteacher (group1,group2)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|group2|
            And I press "Add"
            And I should see "t2 teacher (group2)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "t4 editingteacher (group1,group2)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|group2|
            And I press "Add"
            And I should see "s2 student (group2)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "t4 editingteacher (group1,group2)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#mail_users" "css_element"
            And I should see "t4 editingteacher (group1,group2)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#mail_users" "css_element"
            And I should see "s2 student (group2)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t4 editingteacher (group1,group2)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#mail_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#mail_users" "css_element"
            And I should see "t4 editingteacher (group1,group2)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s2 student (group2)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "t4 editingteacher (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "t4 editingteacher (group1,group2)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "t4 editingteacher (group1,group2)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "t4 editingteacher (group1,group2)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "t4 editingteacher (group1,group2)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#mail_users" "css_element"
            And I should see "t4 editingteacher (group1,group2)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#mail_users" "css_element"
            And I should see "s2 student (group2)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t4 editingteacher (group1,group2)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#mail_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#mail_users" "css_element"
            And I should see "t4 editingteacher (group1,group2)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s2 student (group2)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "t4 editingteacher (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I log out

        And I log in as "t5"
        And I follow "Course One"
        When I click on "Compose New Email" "link" in the "Quickmail" "block"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I log out



# Configuration details:
# Students globally disallowed from using Quickmail.
# Globally repsecting course group mode.
# 'separate groups' set at the course level.
# Students disallowed from using Quickmail at the course level.

Scenario: 40
    Given I log in as "admin"
        And I set the following administration settings values:
            |Allow students to use Quickmail|No|
            |FERPA Mode|Respect Course Mode|
        And I log out

        And I log in as "t4"
        And I follow "Course One"
        And I follow "Edit settings"
		And I expand all fieldsets
        And I set the following fields to these values:
            |Group mode|Separate groups|
        And I press "Save changes"
        And I click on "Configuration" "link" in the "Quickmail" "block"
        And I set the following fields to these values:
            |Allow students to use Quickmail|No|
        And I press "Save changes"
        And I log out


        And I log in as "t1"
        And I follow "Course One"
        When I click on "Compose New Email" "link" in the "Quickmail" "block"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t4 editingteacher (group1)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t4 editingteacher (group1)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t4 editingteacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1)" in the "#mail_users" "css_element"
            And I should see "t4 editingteacher (group1)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t4 editingteacher (group1)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t4 editingteacher (group1)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t4 editingteacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1)" in the "#mail_users" "css_element"
            And I should see "t4 editingteacher (group1)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t4 editingteacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t4 editingteacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t4 editingteacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t4 editingteacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t4 editingteacher (group1)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t4 editingteacher (group1)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t4 editingteacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1)" in the "#mail_users" "css_element"
            And I should see "t4 editingteacher (group1)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I log out

        And I log in as "t4"
        And I follow "Course One"
        When I click on "Compose New Email" "link" in the "Quickmail" "block"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|group2|
            And I press "Add"
            And I should see "t2 teacher (group2)" in the "#mail_users" "css_element"
            And I should see "s2 student (group2)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|group2|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|group2|
            And I press "Add"
            And I should see "t2 teacher (group2)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|group2|
            And I press "Add"
            And I should see "s2 student (group2)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|group3|
            And I press "Add"
            And I should see "t3 teacher (group3)" in the "#mail_users" "css_element"
            And I should see "s3 student (group3)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|group3|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|group3|
            And I press "Add"
            And I should see "t3 teacher (group3)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|group3|
            And I press "Add"
            And I should see "s3 student (group3)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#mail_users" "css_element"
            And I should see "s2 student (group2)" in the "#mail_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#mail_users" "css_element"
            And I should see "s3 student (group3)" in the "#mail_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#mail_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#mail_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#mail_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#mail_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
            And I should see "s2 student (group2)" in the "#mail_users" "css_element"
            And I should see "s3 student (group3)" in the "#mail_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t5 teacher (Not in a group)" in the "#mail_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t5 teacher (Not in a group)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#mail_users" "css_element"
            And I should see "s2 student (group2)" in the "#mail_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#mail_users" "css_element"
            And I should see "s3 student (group3)" in the "#mail_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#mail_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#mail_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
            And I should see "s2 student (group2)" in the "#mail_users" "css_element"
            And I should see "s3 student (group3)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I log out

        And I log in as "s4"
        And I follow "Course One"
        Then I should not see "Quickmail"
        And I log out

        And I log in as "t5"
        And I follow "Course One"
        When I click on "Compose New Email" "link" in the "Quickmail" "block"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I log out



# Configuration details:
# Students globally disallowed from using Quickmail.
# Globally repsecting course group mode.
# Groups set to 'visible' at the course level.
# Students allowed to use Quickmail at the course level.

Scenario: 41
    Given I log in as "admin"
        And I set the following administration settings values:
            |Allow students to use Quickmail|No|
            |FERPA Mode|Respect Course Mode|
        And I log out

        And I log in as "t4"
        And I follow "Course One"
        And I follow "Edit settings"
		And I expand all fieldsets
        And I set the following fields to these values:
            |Group mode|Visible groups|
        And I press "Save changes"
        And I click on "Configuration" "link" in the "Quickmail" "block"
        And I set the following fields to these values:
            |Allow students to use Quickmail|Yes|
        And I press "Save changes"
        And I log out


        And I log in as "t1"
        And I follow "Course One"
        When I click on "Compose New Email" "link" in the "Quickmail" "block"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t4 editingteacher (group1,group2,group3)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t4 editingteacher (group1,group2,group3)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t4 editingteacher (group1,group2,group3)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
            And I should see "t4 editingteacher (group1,group2,group3)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t4 editingteacher (group1,group2,group3)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t4 editingteacher (group1,group2,group3)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t4 editingteacher (group1,group2,group3)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
            And I should see "t4 editingteacher (group1,group2,group3)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t4 editingteacher (group1,group2,group3)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t4 editingteacher (group1,group2,group3)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t4 editingteacher (group1,group2,group3)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t4 editingteacher (group1,group2,group3)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t4 editingteacher (group1,group2,group3)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t4 editingteacher (group1,group2,group3)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t4 editingteacher (group1,group2,group3)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
            And I should see "t4 editingteacher (group1,group2,group3)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I log out

        And I log in as "t4"
        And I follow "Course One"
        When I click on "Compose New Email" "link" in the "Quickmail" "block"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|group2|
            And I press "Add"
            And I should see "t2 teacher (group2)" in the "#mail_users" "css_element"
            And I should see "s2 student (group2)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|group2|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|group2|
            And I press "Add"
            And I should see "t2 teacher (group2)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|group2|
            And I press "Add"
            And I should see "s2 student (group2)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|group3|
            And I press "Add"
            And I should see "t3 teacher (group3)" in the "#mail_users" "css_element"
            And I should see "s3 student (group3)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|group3|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|group3|
            And I press "Add"
            And I should see "t3 teacher (group3)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|group3|
            And I press "Add"
            And I should see "s3 student (group3)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#mail_users" "css_element"
            And I should see "s2 student (group2)" in the "#mail_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#mail_users" "css_element"
            And I should see "s3 student (group3)" in the "#mail_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#mail_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#mail_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#mail_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#mail_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
            And I should see "s2 student (group2)" in the "#mail_users" "css_element"
            And I should see "s3 student (group3)" in the "#mail_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t5 teacher (Not in a group)" in the "#mail_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t5 teacher (Not in a group)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#mail_users" "css_element"
            And I should see "s2 student (group2)" in the "#mail_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#mail_users" "css_element"
            And I should see "s3 student (group3)" in the "#mail_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#mail_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#mail_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
            And I should see "s2 student (group2)" in the "#mail_users" "css_element"
            And I should see "s3 student (group3)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I log out

        And I log in as "s4"
        And I follow "Course One"
        When I click on "Compose New Email" "link" in the "Quickmail" "block"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#mail_users" "css_element"
            And I should see "t4 editingteacher (group1,group2,group3)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t4 editingteacher (group1,group2,group3)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#mail_users" "css_element"
            And I should see "t4 editingteacher (group1,group2,group3)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "t4 editingteacher (group1,group2,group3)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|group2|
            And I press "Add"
            And I should see "t2 teacher (group2)" in the "#mail_users" "css_element"
            And I should see "t4 editingteacher (group1,group2,group3)" in the "#mail_users" "css_element"
            And I should see "s2 student (group2)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|group2|
            And I press "Add"
            And I should see "t4 editingteacher (group1,group2,group3)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|group2|
            And I press "Add"
            And I should see "t2 teacher (group2)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "t4 editingteacher (group1,group2,group3)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|group2|
            And I press "Add"
            And I should see "s2 student (group2)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "t4 editingteacher (group1,group2,group3)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#mail_users" "css_element"
            And I should see "t4 editingteacher (group1,group2,group3)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#mail_users" "css_element"
            And I should see "s2 student (group2)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t4 editingteacher (group1,group2,group3)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#mail_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#mail_users" "css_element"
            And I should see "t4 editingteacher (group1,group2,group3)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s2 student (group2)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "t4 editingteacher (group1,group2,group3)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "t4 editingteacher (group1,group2,group3)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "t4 editingteacher (group1,group2,group3)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "t4 editingteacher (group1,group2,group3)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "t4 editingteacher (group1,group2,group3)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#mail_users" "css_element"
            And I should see "t4 editingteacher (group1,group2,group3)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#mail_users" "css_element"
            And I should see "s2 student (group2)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t4 editingteacher (group1,group2,group3)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#mail_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#mail_users" "css_element"
            And I should see "t4 editingteacher (group1,group2,group3)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s2 student (group2)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "t4 editingteacher (group1,group2,group3)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I log out

        And I log in as "t5"
        And I follow "Course One"
        When I click on "Compose New Email" "link" in the "Quickmail" "block"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I log out



# Configuration details:
# Students globally disallowed from using Quickmail.
# Globally repsecting course group mode.
# Groups set to 'visible' at the course level.
# Students disallowed from using Quickmail at the course level.

Scenario: 42
    Given I log in as "admin"
        And I set the following administration settings values:
            |Allow students to use Quickmail|No|
            |FERPA Mode|Respect Course Mode|
        And I log out

        And I log in as "t4"
        And I follow "Course One"
        And I follow "Edit settings"
		And I expand all fieldsets
        And I set the following fields to these values:
            |Group mode|Visible groups|
        And I press "Save changes"
        And I click on "Configuration" "link" in the "Quickmail" "block"
        And I set the following fields to these values:
            |Allow students to use Quickmail|No|
        And I press "Save changes"
        And I log out


        And I log in as "t1"
        And I follow "Course One"
        When I click on "Compose New Email" "link" in the "Quickmail" "block"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t4 editingteacher (group1,group2,group3)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t4 editingteacher (group1,group2,group3)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t4 editingteacher (group1,group2,group3)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
            And I should see "t4 editingteacher (group1,group2,group3)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t4 editingteacher (group1,group2,group3)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t4 editingteacher (group1,group2,group3)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t4 editingteacher (group1,group2,group3)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
            And I should see "t4 editingteacher (group1,group2,group3)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t4 editingteacher (group1,group2,group3)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t4 editingteacher (group1,group2,group3)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t4 editingteacher (group1,group2,group3)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t4 editingteacher (group1,group2,group3)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t4 editingteacher (group1,group2,group3)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t4 editingteacher (group1,group2,group3)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t4 editingteacher (group1,group2,group3)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
            And I should see "t4 editingteacher (group1,group2,group3)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I log out

        And I log in as "t4"
        And I follow "Course One"
        When I click on "Compose New Email" "link" in the "Quickmail" "block"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|group2|
            And I press "Add"
            And I should see "t2 teacher (group2)" in the "#mail_users" "css_element"
            And I should see "s2 student (group2)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|group2|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|group2|
            And I press "Add"
            And I should see "t2 teacher (group2)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|group2|
            And I press "Add"
            And I should see "s2 student (group2)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|group3|
            And I press "Add"
            And I should see "t3 teacher (group3)" in the "#mail_users" "css_element"
            And I should see "s3 student (group3)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|group3|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|group3|
            And I press "Add"
            And I should see "t3 teacher (group3)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|group3|
            And I press "Add"
            And I should see "s3 student (group3)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#mail_users" "css_element"
            And I should see "s2 student (group2)" in the "#mail_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#mail_users" "css_element"
            And I should see "s3 student (group3)" in the "#mail_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#mail_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#mail_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#mail_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#mail_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
            And I should see "s2 student (group2)" in the "#mail_users" "css_element"
            And I should see "s3 student (group3)" in the "#mail_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t5 teacher (Not in a group)" in the "#mail_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t5 teacher (Not in a group)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#mail_users" "css_element"
            And I should see "s2 student (group2)" in the "#mail_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#mail_users" "css_element"
            And I should see "s3 student (group3)" in the "#mail_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#mail_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#mail_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
            And I should see "s2 student (group2)" in the "#mail_users" "css_element"
            And I should see "s3 student (group3)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I log out

        And I log in as "s4"
        And I follow "Course One"
        Then I should not see "Quickmail"
        And I log out

        And I log in as "t5"
        And I follow "Course One"
        When I click on "Compose New Email" "link" in the "Quickmail" "block"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I log out



# Configuration details:
# Students globally disallowed from using Quickmail.
# Globally ignoring groups
# unrecognized setting for groupsCourse.
# Students allowed to use Quickmail at the course level.

Scenario: 43
    Given I log in as "admin"
        And I set the following administration settings values:
            |Allow students to use Quickmail|No|
            |FERPA Mode|No Group Respect|
        And I log out

        And I log in as "t4"
        And I follow "Course One"
        And I click on "Configuration" "link" in the "Quickmail" "block"
        And I set the following fields to these values:
            |Allow students to use Quickmail|Yes|
        And I press "Save changes"
        And I log out


        And I log in as "t1"
        And I follow "Course One"
        When I click on "Compose New Email" "link" in the "Quickmail" "block"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t4 editingteacher" in the "#mail_users" "css_element"
            And I should see "s1 student" in the "#mail_users" "css_element"
            And I should see "s4 student" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t4 editingteacher" in the "#mail_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "s1 student" in the "#mail_users" "css_element"
            And I should see "s4 student" in the "#mail_users" "css_element"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t4 editingteacher" in the "#mail_users" "css_element"
            And I should see "s1 student" in the "#mail_users" "css_element"
            And I should see "s4 student" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t4 editingteacher" in the "#mail_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s1 student" in the "#mail_users" "css_element"
            And I should see "s4 student" in the "#mail_users" "css_element"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t4 editingteacher" in the "#mail_users" "css_element"
            And I should see "s1 student" in the "#mail_users" "css_element"
            And I should see "s4 student" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t4 editingteacher" in the "#mail_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s1 student" in the "#mail_users" "css_element"
            And I should see "s4 student" in the "#mail_users" "css_element"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I log out

        And I log in as "t4"
        And I follow "Course One"
        When I click on "Compose New Email" "link" in the "Quickmail" "block"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t1 teacher" in the "#mail_users" "css_element"
            And I should see "s1 student" in the "#mail_users" "css_element"
            And I should see "s4 student" in the "#mail_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t1 teacher" in the "#mail_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "s1 student" in the "#mail_users" "css_element"
            And I should see "s4 student" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|group2|
            And I press "Add"
            And I should see "t2 teacher" in the "#mail_users" "css_element"
            And I should see "s2 student" in the "#mail_users" "css_element"
            And I should see "s4 student" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|group2|
            And I press "Add"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|group2|
            And I press "Add"
            And I should see "t2 teacher" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|group2|
            And I press "Add"
            And I should see "s2 student" in the "#mail_users" "css_element"
            And I should see "s4 student" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|group3|
            And I press "Add"
            And I should see "t3 teacher" in the "#mail_users" "css_element"
            And I should see "s3 student" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|group3|
            And I press "Add"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|group3|
            And I press "Add"
            And I should see "t3 teacher" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|group3|
            And I press "Add"
            And I should see "s3 student" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t1 teacher" in the "#mail_users" "css_element"
            And I should see "s1 student" in the "#mail_users" "css_element"
            And I should see "s4 student" in the "#mail_users" "css_element"
            And I should see "t2 teacher" in the "#mail_users" "css_element"
            And I should see "s2 student" in the "#mail_users" "css_element"
            And I should see "t3 teacher" in the "#mail_users" "css_element"
            And I should see "s3 student" in the "#mail_users" "css_element"
            And I should see "t5 teacher" in the "#mail_users" "css_element"
            And I should see "s5 student" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t1 teacher" in the "#mail_users" "css_element"
            And I should see "t2 teacher" in the "#mail_users" "css_element"
            And I should see "t3 teacher" in the "#mail_users" "css_element"
            And I should see "t5 teacher" in the "#mail_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s1 student" in the "#mail_users" "css_element"
            And I should see "s4 student" in the "#mail_users" "css_element"
            And I should see "s2 student" in the "#mail_users" "css_element"
            And I should see "s3 student" in the "#mail_users" "css_element"
            And I should see "s5 student" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t5 teacher" in the "#mail_users" "css_element"
            And I should see "s5 student" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t5 teacher" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t1 teacher" in the "#mail_users" "css_element"
            And I should see "s1 student" in the "#mail_users" "css_element"
            And I should see "s4 student" in the "#mail_users" "css_element"
            And I should see "t2 teacher" in the "#mail_users" "css_element"
            And I should see "s2 student" in the "#mail_users" "css_element"
            And I should see "t3 teacher" in the "#mail_users" "css_element"
            And I should see "s3 student" in the "#mail_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t1 teacher" in the "#mail_users" "css_element"
            And I should see "t2 teacher" in the "#mail_users" "css_element"
            And I should see "t3 teacher" in the "#mail_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s1 student" in the "#mail_users" "css_element"
            And I should see "s4 student" in the "#mail_users" "css_element"
            And I should see "s2 student" in the "#mail_users" "css_element"
            And I should see "s3 student" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I log out

        And I log in as "s4"
        And I follow "Course One"
        When I click on "Compose New Email" "link" in the "Quickmail" "block"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t1 teacher" in the "#mail_users" "css_element"
            And I should see "t4 editingteacher" in the "#mail_users" "css_element"
            And I should see "s1 student" in the "#mail_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t4 editingteacher" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t1 teacher" in the "#mail_users" "css_element"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "s1 student" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|group2|
            And I press "Add"
            And I should see "t2 teacher" in the "#mail_users" "css_element"
            And I should see "t4 editingteacher" in the "#mail_users" "css_element"
            And I should see "s2 student" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|group2|
            And I press "Add"
            And I should see "t4 editingteacher" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|group2|
            And I press "Add"
            And I should see "t2 teacher" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|group2|
            And I press "Add"
            And I should see "s2 student" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t1 teacher" in the "#mail_users" "css_element"
            And I should see "t4 editingteacher" in the "#mail_users" "css_element"
            And I should see "s1 student" in the "#mail_users" "css_element"
            And I should see "t2 teacher" in the "#mail_users" "css_element"
            And I should see "s2 student" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t4 editingteacher" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t1 teacher" in the "#mail_users" "css_element"
            And I should see "t2 teacher" in the "#mail_users" "css_element"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s1 student" in the "#mail_users" "css_element"
            And I should see "s2 student" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t1 teacher" in the "#mail_users" "css_element"
            And I should see "t4 editingteacher" in the "#mail_users" "css_element"
            And I should see "s1 student" in the "#mail_users" "css_element"
            And I should see "t2 teacher" in the "#mail_users" "css_element"
            And I should see "s2 student" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t4 editingteacher" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t1 teacher" in the "#mail_users" "css_element"
            And I should see "t2 teacher" in the "#mail_users" "css_element"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s1 student" in the "#mail_users" "css_element"
            And I should see "s2 student" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I log out

        And I log in as "t5"
        And I follow "Course One"
        When I click on "Compose New Email" "link" in the "Quickmail" "block"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s5 student" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s5 student" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I log out



# Configuration details:
# Students globally disallowed from using Quickmail.
# Globally ignoring groups
# unrecognized setting for groupsCourse.
# Students disallowed from using Quickmail at the course level.

Scenario: 44
    Given I log in as "admin"
        And I set the following administration settings values:
            |Allow students to use Quickmail|No|
            |FERPA Mode|No Group Respect|
        And I log out

        And I log in as "t4"
        And I follow "Course One"
        And I click on "Configuration" "link" in the "Quickmail" "block"
        And I set the following fields to these values:
            |Allow students to use Quickmail|No|
        And I press "Save changes"
        And I log out


        And I log in as "t1"
        And I follow "Course One"
        When I click on "Compose New Email" "link" in the "Quickmail" "block"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t4 editingteacher" in the "#mail_users" "css_element"
            And I should see "s1 student" in the "#mail_users" "css_element"
            And I should see "s4 student" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t4 editingteacher" in the "#mail_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "s1 student" in the "#mail_users" "css_element"
            And I should see "s4 student" in the "#mail_users" "css_element"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t4 editingteacher" in the "#mail_users" "css_element"
            And I should see "s1 student" in the "#mail_users" "css_element"
            And I should see "s4 student" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t4 editingteacher" in the "#mail_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s1 student" in the "#mail_users" "css_element"
            And I should see "s4 student" in the "#mail_users" "css_element"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t4 editingteacher" in the "#mail_users" "css_element"
            And I should see "s1 student" in the "#mail_users" "css_element"
            And I should see "s4 student" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t4 editingteacher" in the "#mail_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s1 student" in the "#mail_users" "css_element"
            And I should see "s4 student" in the "#mail_users" "css_element"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I log out

        And I log in as "t4"
        And I follow "Course One"
        When I click on "Compose New Email" "link" in the "Quickmail" "block"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t1 teacher" in the "#mail_users" "css_element"
            And I should see "s1 student" in the "#mail_users" "css_element"
            And I should see "s4 student" in the "#mail_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t1 teacher" in the "#mail_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "s1 student" in the "#mail_users" "css_element"
            And I should see "s4 student" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|group2|
            And I press "Add"
            And I should see "t2 teacher" in the "#mail_users" "css_element"
            And I should see "s2 student" in the "#mail_users" "css_element"
            And I should see "s4 student" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|group2|
            And I press "Add"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|group2|
            And I press "Add"
            And I should see "t2 teacher" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|group2|
            And I press "Add"
            And I should see "s2 student" in the "#mail_users" "css_element"
            And I should see "s4 student" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|group3|
            And I press "Add"
            And I should see "t3 teacher" in the "#mail_users" "css_element"
            And I should see "s3 student" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|group3|
            And I press "Add"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|group3|
            And I press "Add"
            And I should see "t3 teacher" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|group3|
            And I press "Add"
            And I should see "s3 student" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t1 teacher" in the "#mail_users" "css_element"
            And I should see "s1 student" in the "#mail_users" "css_element"
            And I should see "s4 student" in the "#mail_users" "css_element"
            And I should see "t2 teacher" in the "#mail_users" "css_element"
            And I should see "s2 student" in the "#mail_users" "css_element"
            And I should see "t3 teacher" in the "#mail_users" "css_element"
            And I should see "s3 student" in the "#mail_users" "css_element"
            And I should see "t5 teacher" in the "#mail_users" "css_element"
            And I should see "s5 student" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t1 teacher" in the "#mail_users" "css_element"
            And I should see "t2 teacher" in the "#mail_users" "css_element"
            And I should see "t3 teacher" in the "#mail_users" "css_element"
            And I should see "t5 teacher" in the "#mail_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s1 student" in the "#mail_users" "css_element"
            And I should see "s4 student" in the "#mail_users" "css_element"
            And I should see "s2 student" in the "#mail_users" "css_element"
            And I should see "s3 student" in the "#mail_users" "css_element"
            And I should see "s5 student" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t5 teacher" in the "#mail_users" "css_element"
            And I should see "s5 student" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t5 teacher" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t1 teacher" in the "#mail_users" "css_element"
            And I should see "s1 student" in the "#mail_users" "css_element"
            And I should see "s4 student" in the "#mail_users" "css_element"
            And I should see "t2 teacher" in the "#mail_users" "css_element"
            And I should see "s2 student" in the "#mail_users" "css_element"
            And I should see "t3 teacher" in the "#mail_users" "css_element"
            And I should see "s3 student" in the "#mail_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t1 teacher" in the "#mail_users" "css_element"
            And I should see "t2 teacher" in the "#mail_users" "css_element"
            And I should see "t3 teacher" in the "#mail_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s1 student" in the "#mail_users" "css_element"
            And I should see "s4 student" in the "#mail_users" "css_element"
            And I should see "s2 student" in the "#mail_users" "css_element"
            And I should see "s3 student" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I log out

        And I log in as "s4"
        And I follow "Course One"
        Then I should not see "Quickmail"
        And I log out

        And I log in as "t5"
        And I follow "Course One"
        When I click on "Compose New Email" "link" in the "Quickmail" "block"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s5 student" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s5 student" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I log out



# Configuration details:
# Students globally PROHIBITED from using Quickmail.
# Globally enforcing separate groups always.
# unrecognized setting for groupsCourse.
# unrecognized setting for allowStudentsCourse.

Scenario: 45
    Given I log in as "admin"
        And I set the following administration settings values:
            |Allow students to use Quickmail|Never|
            |FERPA Mode|Always Separate Groups|
        And I log out


        And I log in as "t1"
        And I follow "Course One"
        When I click on "Compose New Email" "link" in the "Quickmail" "block"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t4 editingteacher (group1)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t4 editingteacher (group1)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t4 editingteacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1)" in the "#mail_users" "css_element"
            And I should see "t4 editingteacher (group1)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t4 editingteacher (group1)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t4 editingteacher (group1)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t4 editingteacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1)" in the "#mail_users" "css_element"
            And I should see "t4 editingteacher (group1)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t4 editingteacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t4 editingteacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t4 editingteacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t4 editingteacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t4 editingteacher (group1)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t4 editingteacher (group1)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t4 editingteacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1)" in the "#mail_users" "css_element"
            And I should see "t4 editingteacher (group1)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I log out

        And I log in as "t4"
        And I follow "Course One"
        When I click on "Compose New Email" "link" in the "Quickmail" "block"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|group2|
            And I press "Add"
            And I should see "t2 teacher (group2)" in the "#mail_users" "css_element"
            And I should see "s2 student (group2)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|group2|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|group2|
            And I press "Add"
            And I should see "t2 teacher (group2)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|group2|
            And I press "Add"
            And I should see "s2 student (group2)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|group3|
            And I press "Add"
            And I should see "t3 teacher (group3)" in the "#mail_users" "css_element"
            And I should see "s3 student (group3)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|group3|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|group3|
            And I press "Add"
            And I should see "t3 teacher (group3)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|group3|
            And I press "Add"
            And I should see "s3 student (group3)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#mail_users" "css_element"
            And I should see "s2 student (group2)" in the "#mail_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#mail_users" "css_element"
            And I should see "s3 student (group3)" in the "#mail_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#mail_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#mail_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#mail_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#mail_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
            And I should see "s2 student (group2)" in the "#mail_users" "css_element"
            And I should see "s3 student (group3)" in the "#mail_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t5 teacher (Not in a group)" in the "#mail_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t5 teacher (Not in a group)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#mail_users" "css_element"
            And I should see "s2 student (group2)" in the "#mail_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#mail_users" "css_element"
            And I should see "s3 student (group3)" in the "#mail_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#mail_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#mail_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
            And I should see "s2 student (group2)" in the "#mail_users" "css_element"
            And I should see "s3 student (group3)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I log out

        And I log in as "s4"
        And I follow "Course One"
        Then I should not see "Quickmail"
        And I log out

        And I log in as "t5"
        And I follow "Course One"
        When I click on "Compose New Email" "link" in the "Quickmail" "block"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I log out



# Configuration details:
# Students globally PROHIBITED from using Quickmail.
# Globally repsecting course group mode.
# 'No groups' set at course level.
# unrecognized setting for allowStudentsCourse.

Scenario: 46
    Given I log in as "admin"
        And I set the following administration settings values:
            |Allow students to use Quickmail|Never|
            |FERPA Mode|Respect Course Mode|
        And I log out

        And I log in as "t4"
        And I follow "Course One"
        And I follow "Edit settings"
		And I expand all fieldsets
        And I set the following fields to these values:
            |Group mode|No groups|
        And I press "Save changes"
        And I log out


        And I log in as "t1"
        And I follow "Course One"
        When I click on "Compose New Email" "link" in the "Quickmail" "block"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t4 editingteacher" in the "#mail_users" "css_element"
            And I should see "s1 student" in the "#mail_users" "css_element"
            And I should see "s4 student" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t4 editingteacher" in the "#mail_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "s1 student" in the "#mail_users" "css_element"
            And I should see "s4 student" in the "#mail_users" "css_element"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t4 editingteacher" in the "#mail_users" "css_element"
            And I should see "s1 student" in the "#mail_users" "css_element"
            And I should see "s4 student" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t4 editingteacher" in the "#mail_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s1 student" in the "#mail_users" "css_element"
            And I should see "s4 student" in the "#mail_users" "css_element"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t4 editingteacher" in the "#mail_users" "css_element"
            And I should see "s1 student" in the "#mail_users" "css_element"
            And I should see "s4 student" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t4 editingteacher" in the "#mail_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s1 student" in the "#mail_users" "css_element"
            And I should see "s4 student" in the "#mail_users" "css_element"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I log out

        And I log in as "t4"
        And I follow "Course One"
        When I click on "Compose New Email" "link" in the "Quickmail" "block"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t1 teacher" in the "#mail_users" "css_element"
            And I should see "s1 student" in the "#mail_users" "css_element"
            And I should see "s4 student" in the "#mail_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t1 teacher" in the "#mail_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "s1 student" in the "#mail_users" "css_element"
            And I should see "s4 student" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|group2|
            And I press "Add"
            And I should see "t2 teacher" in the "#mail_users" "css_element"
            And I should see "s2 student" in the "#mail_users" "css_element"
            And I should see "s4 student" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|group2|
            And I press "Add"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|group2|
            And I press "Add"
            And I should see "t2 teacher" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|group2|
            And I press "Add"
            And I should see "s2 student" in the "#mail_users" "css_element"
            And I should see "s4 student" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|group3|
            And I press "Add"
            And I should see "t3 teacher" in the "#mail_users" "css_element"
            And I should see "s3 student" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|group3|
            And I press "Add"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|group3|
            And I press "Add"
            And I should see "t3 teacher" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|group3|
            And I press "Add"
            And I should see "s3 student" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t1 teacher" in the "#mail_users" "css_element"
            And I should see "s1 student" in the "#mail_users" "css_element"
            And I should see "s4 student" in the "#mail_users" "css_element"
            And I should see "t2 teacher" in the "#mail_users" "css_element"
            And I should see "s2 student" in the "#mail_users" "css_element"
            And I should see "t3 teacher" in the "#mail_users" "css_element"
            And I should see "s3 student" in the "#mail_users" "css_element"
            And I should see "t5 teacher" in the "#mail_users" "css_element"
            And I should see "s5 student" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t1 teacher" in the "#mail_users" "css_element"
            And I should see "t2 teacher" in the "#mail_users" "css_element"
            And I should see "t3 teacher" in the "#mail_users" "css_element"
            And I should see "t5 teacher" in the "#mail_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s1 student" in the "#mail_users" "css_element"
            And I should see "s4 student" in the "#mail_users" "css_element"
            And I should see "s2 student" in the "#mail_users" "css_element"
            And I should see "s3 student" in the "#mail_users" "css_element"
            And I should see "s5 student" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t5 teacher" in the "#mail_users" "css_element"
            And I should see "s5 student" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t5 teacher" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t1 teacher" in the "#mail_users" "css_element"
            And I should see "s1 student" in the "#mail_users" "css_element"
            And I should see "s4 student" in the "#mail_users" "css_element"
            And I should see "t2 teacher" in the "#mail_users" "css_element"
            And I should see "s2 student" in the "#mail_users" "css_element"
            And I should see "t3 teacher" in the "#mail_users" "css_element"
            And I should see "s3 student" in the "#mail_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t1 teacher" in the "#mail_users" "css_element"
            And I should see "t2 teacher" in the "#mail_users" "css_element"
            And I should see "t3 teacher" in the "#mail_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s1 student" in the "#mail_users" "css_element"
            And I should see "s4 student" in the "#mail_users" "css_element"
            And I should see "s2 student" in the "#mail_users" "css_element"
            And I should see "s3 student" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I log out

        And I log in as "s4"
        And I follow "Course One"
        Then I should not see "Quickmail"
        And I log out

        And I log in as "t5"
        And I follow "Course One"
        When I click on "Compose New Email" "link" in the "Quickmail" "block"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s5 student" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s5 student" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I log out



# Configuration details:
# Students globally PROHIBITED from using Quickmail.
# Globally repsecting course group mode.
# 'separate groups' set at the course level.
# unrecognized setting for allowStudentsCourse.

Scenario: 47
    Given I log in as "admin"
        And I set the following administration settings values:
            |Allow students to use Quickmail|Never|
            |FERPA Mode|Respect Course Mode|
        And I log out

        And I log in as "t4"
        And I follow "Course One"
        And I follow "Edit settings"
		And I expand all fieldsets
        And I set the following fields to these values:
            |Group mode|Separate groups|
        And I press "Save changes"
        And I log out


        And I log in as "t1"
        And I follow "Course One"
        When I click on "Compose New Email" "link" in the "Quickmail" "block"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t4 editingteacher (group1)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t4 editingteacher (group1)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t4 editingteacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1)" in the "#mail_users" "css_element"
            And I should see "t4 editingteacher (group1)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t4 editingteacher (group1)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t4 editingteacher (group1)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t4 editingteacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1)" in the "#mail_users" "css_element"
            And I should see "t4 editingteacher (group1)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t4 editingteacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t4 editingteacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t4 editingteacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t4 editingteacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t4 editingteacher (group1)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t4 editingteacher (group1)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t4 editingteacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1)" in the "#mail_users" "css_element"
            And I should see "t4 editingteacher (group1)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I log out

        And I log in as "t4"
        And I follow "Course One"
        When I click on "Compose New Email" "link" in the "Quickmail" "block"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|group2|
            And I press "Add"
            And I should see "t2 teacher (group2)" in the "#mail_users" "css_element"
            And I should see "s2 student (group2)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|group2|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|group2|
            And I press "Add"
            And I should see "t2 teacher (group2)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|group2|
            And I press "Add"
            And I should see "s2 student (group2)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|group3|
            And I press "Add"
            And I should see "t3 teacher (group3)" in the "#mail_users" "css_element"
            And I should see "s3 student (group3)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|group3|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|group3|
            And I press "Add"
            And I should see "t3 teacher (group3)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|group3|
            And I press "Add"
            And I should see "s3 student (group3)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#mail_users" "css_element"
            And I should see "s2 student (group2)" in the "#mail_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#mail_users" "css_element"
            And I should see "s3 student (group3)" in the "#mail_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#mail_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#mail_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#mail_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#mail_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
            And I should see "s2 student (group2)" in the "#mail_users" "css_element"
            And I should see "s3 student (group3)" in the "#mail_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t5 teacher (Not in a group)" in the "#mail_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t5 teacher (Not in a group)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#mail_users" "css_element"
            And I should see "s2 student (group2)" in the "#mail_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#mail_users" "css_element"
            And I should see "s3 student (group3)" in the "#mail_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#mail_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#mail_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
            And I should see "s2 student (group2)" in the "#mail_users" "css_element"
            And I should see "s3 student (group3)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I log out

        And I log in as "s4"
        And I follow "Course One"
        Then I should not see "Quickmail"
        And I log out

        And I log in as "t5"
        And I follow "Course One"
        When I click on "Compose New Email" "link" in the "Quickmail" "block"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I log out



# Configuration details:
# Students globally PROHIBITED from using Quickmail.
# Globally repsecting course group mode.
# Groups set to 'visible' at the course level.
# unrecognized setting for allowStudentsCourse.

Scenario: 48
    Given I log in as "admin"
        And I set the following administration settings values:
            |Allow students to use Quickmail|Never|
            |FERPA Mode|Respect Course Mode|
        And I log out

        And I log in as "t4"
        And I follow "Course One"
        And I follow "Edit settings"
		And I expand all fieldsets
        And I set the following fields to these values:
            |Group mode|Visible groups|
        And I press "Save changes"
        And I log out


        And I log in as "t1"
        And I follow "Course One"
        When I click on "Compose New Email" "link" in the "Quickmail" "block"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t4 editingteacher (group1,group2,group3)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t4 editingteacher (group1,group2,group3)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t4 editingteacher (group1,group2,group3)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
            And I should see "t4 editingteacher (group1,group2,group3)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t4 editingteacher (group1,group2,group3)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t4 editingteacher (group1,group2,group3)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t4 editingteacher (group1,group2,group3)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
            And I should see "t4 editingteacher (group1,group2,group3)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t4 editingteacher (group1,group2,group3)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t4 editingteacher (group1,group2,group3)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t4 editingteacher (group1,group2,group3)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t4 editingteacher (group1,group2,group3)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t4 editingteacher (group1,group2,group3)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t4 editingteacher (group1,group2,group3)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t4 editingteacher (group1,group2,group3)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
            And I should see "t4 editingteacher (group1,group2,group3)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I log out

        And I log in as "t4"
        And I follow "Course One"
        When I click on "Compose New Email" "link" in the "Quickmail" "block"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|group2|
            And I press "Add"
            And I should see "t2 teacher (group2)" in the "#mail_users" "css_element"
            And I should see "s2 student (group2)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|group2|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|group2|
            And I press "Add"
            And I should see "t2 teacher (group2)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|group2|
            And I press "Add"
            And I should see "s2 student (group2)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|group3|
            And I press "Add"
            And I should see "t3 teacher (group3)" in the "#mail_users" "css_element"
            And I should see "s3 student (group3)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|group3|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|group3|
            And I press "Add"
            And I should see "t3 teacher (group3)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|group3|
            And I press "Add"
            And I should see "s3 student (group3)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#mail_users" "css_element"
            And I should see "s2 student (group2)" in the "#mail_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#mail_users" "css_element"
            And I should see "s3 student (group3)" in the "#mail_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#mail_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#mail_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#mail_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#mail_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
            And I should see "s2 student (group2)" in the "#mail_users" "css_element"
            And I should see "s3 student (group3)" in the "#mail_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t5 teacher (Not in a group)" in the "#mail_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t5 teacher (Not in a group)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#mail_users" "css_element"
            And I should see "s2 student (group2)" in the "#mail_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#mail_users" "css_element"
            And I should see "s3 student (group3)" in the "#mail_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t1 teacher (group1)" in the "#mail_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#mail_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#mail_users" "css_element"
            And I should see "s1 student (group1)" in the "#from_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#from_users" "css_element"
            And I should see "s2 student (group2)" in the "#from_users" "css_element"
            And I should see "s3 student (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s1 student (group1)" in the "#mail_users" "css_element"
            And I should see "s4 student (group1,group2)" in the "#mail_users" "css_element"
            And I should see "s2 student (group2)" in the "#mail_users" "css_element"
            And I should see "s3 student (group3)" in the "#mail_users" "css_element"
            And I should see "t1 teacher (group1)" in the "#from_users" "css_element"
            And I should see "t2 teacher (group2)" in the "#from_users" "css_element"
            And I should see "t3 teacher (group3)" in the "#from_users" "css_element"
            And I should see "t5 teacher (Not in a group)" in the "#from_users" "css_element"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I log out

        And I log in as "s4"
        And I follow "Course One"
        Then I should not see "Quickmail"
        And I log out

        And I log in as "t5"
        And I follow "Course One"
        When I click on "Compose New Email" "link" in the "Quickmail" "block"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s5 student (Not in a group)" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I log out



# Configuration details:
# Students globally PROHIBITED from using Quickmail.
# Globally ignoring groups
# unrecognized setting for groupsCourse.
# unrecognized setting for allowStudentsCourse.

Scenario: 49
    Given I log in as "admin"
        And I set the following administration settings values:
            |Allow students to use Quickmail|Never|
            |FERPA Mode|No Group Respect|
        And I log out


        And I log in as "t1"
        And I follow "Course One"
        When I click on "Compose New Email" "link" in the "Quickmail" "block"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t4 editingteacher" in the "#mail_users" "css_element"
            And I should see "s1 student" in the "#mail_users" "css_element"
            And I should see "s4 student" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t4 editingteacher" in the "#mail_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "s1 student" in the "#mail_users" "css_element"
            And I should see "s4 student" in the "#mail_users" "css_element"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t4 editingteacher" in the "#mail_users" "css_element"
            And I should see "s1 student" in the "#mail_users" "css_element"
            And I should see "s4 student" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t4 editingteacher" in the "#mail_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s1 student" in the "#mail_users" "css_element"
            And I should see "s4 student" in the "#mail_users" "css_element"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t4 editingteacher" in the "#mail_users" "css_element"
            And I should see "s1 student" in the "#mail_users" "css_element"
            And I should see "s4 student" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t4 editingteacher" in the "#mail_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s1 student" in the "#mail_users" "css_element"
            And I should see "s4 student" in the "#mail_users" "css_element"
            And I should see "t4 editingteacher" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I log out

        And I log in as "t4"
        And I follow "Course One"
        When I click on "Compose New Email" "link" in the "Quickmail" "block"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t1 teacher" in the "#mail_users" "css_element"
            And I should see "s1 student" in the "#mail_users" "css_element"
            And I should see "s4 student" in the "#mail_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "t1 teacher" in the "#mail_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|group1|
            And I press "Add"
            And I should see "s1 student" in the "#mail_users" "css_element"
            And I should see "s4 student" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|group2|
            And I press "Add"
            And I should see "t2 teacher" in the "#mail_users" "css_element"
            And I should see "s2 student" in the "#mail_users" "css_element"
            And I should see "s4 student" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|group2|
            And I press "Add"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|group2|
            And I press "Add"
            And I should see "t2 teacher" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|group2|
            And I press "Add"
            And I should see "s2 student" in the "#mail_users" "css_element"
            And I should see "s4 student" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|group3|
            And I press "Add"
            And I should see "t3 teacher" in the "#mail_users" "css_element"
            And I should see "s3 student" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|group3|
            And I press "Add"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|group3|
            And I press "Add"
            And I should see "t3 teacher" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|group3|
            And I press "Add"
            And I should see "s3 student" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t1 teacher" in the "#mail_users" "css_element"
            And I should see "s1 student" in the "#mail_users" "css_element"
            And I should see "s4 student" in the "#mail_users" "css_element"
            And I should see "t2 teacher" in the "#mail_users" "css_element"
            And I should see "s2 student" in the "#mail_users" "css_element"
            And I should see "t3 teacher" in the "#mail_users" "css_element"
            And I should see "s3 student" in the "#mail_users" "css_element"
            And I should see "t5 teacher" in the "#mail_users" "css_element"
            And I should see "s5 student" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "t1 teacher" in the "#mail_users" "css_element"
            And I should see "t2 teacher" in the "#mail_users" "css_element"
            And I should see "t3 teacher" in the "#mail_users" "css_element"
            And I should see "t5 teacher" in the "#mail_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s1 student" in the "#mail_users" "css_element"
            And I should see "s4 student" in the "#mail_users" "css_element"
            And I should see "s2 student" in the "#mail_users" "css_element"
            And I should see "s3 student" in the "#mail_users" "css_element"
            And I should see "s5 student" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t5 teacher" in the "#mail_users" "css_element"
            And I should see "s5 student" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "t5 teacher" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t1 teacher" in the "#mail_users" "css_element"
            And I should see "s1 student" in the "#mail_users" "css_element"
            And I should see "s4 student" in the "#mail_users" "css_element"
            And I should see "t2 teacher" in the "#mail_users" "css_element"
            And I should see "s2 student" in the "#mail_users" "css_element"
            And I should see "t3 teacher" in the "#mail_users" "css_element"
            And I should see "s3 student" in the "#mail_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "t1 teacher" in the "#mail_users" "css_element"
            And I should see "t2 teacher" in the "#mail_users" "css_element"
            And I should see "t3 teacher" in the "#mail_users" "css_element"
            And I should see "s1 student" in the "#from_users" "css_element"
            And I should see "s4 student" in the "#from_users" "css_element"
            And I should see "s2 student" in the "#from_users" "css_element"
            And I should see "s3 student" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s1 student" in the "#mail_users" "css_element"
            And I should see "s4 student" in the "#mail_users" "css_element"
            And I should see "s2 student" in the "#mail_users" "css_element"
            And I should see "s3 student" in the "#mail_users" "css_element"
            And I should see "t1 teacher" in the "#from_users" "css_element"
            And I should see "t2 teacher" in the "#from_users" "css_element"
            And I should see "t3 teacher" in the "#from_users" "css_element"
            And I should see "t5 teacher" in the "#from_users" "css_element"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I log out

        And I log in as "s4"
        And I follow "Course One"
        Then I should not see "Quickmail"
        And I log out

        And I log in as "t5"
        And I follow "Course One"
        When I click on "Compose New Email" "link" in the "Quickmail" "block"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s5 student" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Users|
            And I press "Add"
            And I should see "s5 student" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|Not in a group|
            And I press "Add"
            And I should see "s5 student" in the "#mail_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|No filter|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|editingteacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|teacher|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I set the following fields to these values:
            |roles|student|
        And I set the following fields to these values:
            |groups|All Groups|
            And I press "Add"
            And I should see "s5 student" in the "#from_users" "css_element"
        Then I press "Remove All"
        And I log out

